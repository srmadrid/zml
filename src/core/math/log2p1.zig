const std = @import("std");
const types = @import("../types.zig");
const math = @import("../math.zig");
const EnsureFloat = types.EnsureFloat;
const cast = types.cast;

pub fn log2p1(x: anytype) EnsureFloat(@TypeOf(x)) {
    comptime if (!types.isFixedPrecision(@TypeOf(x)) or types.isComplex(@TypeOf(x)))
        @compileError("x must be an int or float");

    switch (types.numericType(@TypeOf(x))) {
        .int => {
            return log2p1(cast(EnsureFloat(@TypeOf(x)), x, .{}));
        },
        .float => {
            if (math.abs(x) < std.math.floatEps(@TypeOf(x)) / 4) {
                // Avoid spurious underflows when log1p underflows but log2p1
                // should not.
                const ret: @TypeOf(x) = std.math.log2e * x;

                if (math.abs(ret) < std.math.floatMin(@TypeOf(x))) {
                    const vret: @TypeOf(x) = ret * ret;
                    std.mem.doNotOptimizeAway(vret);
                }

                return ret;
            }
            return std.math.log2e * math.log1p(x);
        },
        else => unreachable,
    }
}

test log2p1 {
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, log2p1(@as(f32, -0x0p+0)));
    try std.testing.expectEqual(0x1.715476p+0, log2p1(@as(f32, 0x1.b7e152p+0)));
    // try std.testing.expectEqual(0x1.715476p+0, log2p1(@as(f32, 0x1.b7e15p+0)));
    try std.testing.expectEqual(-0x6.a3fe6p-4, log2p1(@as(f32, -0x4p-4)));
    try std.testing.expectEqual(-0x3p+0, log2p1(@as(f32, -0xep-4)));
    // try std.testing.expectEqual(0xb.5d69cp-8, log2p1(@as(f32, 0x8p-8)));
    // try std.testing.expectEqual(0x5.c4995p-12, log2p1(@as(f32, 0x4p-12)));
    // try std.testing.expectEqual(0x2.e2a60cp-16, log2p1(@as(f32, 0x2p-16)));
    try std.testing.expectEqual(0x1.71546ap-20, log2p1(@as(f32, 0x1p-20)));
    try std.testing.expectEqual(0xb.8aa3bp-28, log2p1(@as(f32, 0x8p-28)));
    try std.testing.expectEqual(0x5.c551d8p-32, log2p1(@as(f32, 0x4p-32)));
    try std.testing.expectEqual(0x2.e2a8ecp-36, log2p1(@as(f32, 0x2p-36)));
    try std.testing.expectEqual(0x1.715476p-40, log2p1(@as(f32, 0x1p-40)));
    try std.testing.expectEqual(0xb.8aa3bp-48, log2p1(@as(f32, 0x8p-48)));
    try std.testing.expectEqual(0x5.c551d8p-52, log2p1(@as(f32, 0x4p-52)));
    try std.testing.expectEqual(0x2.e2a8ecp-56, log2p1(@as(f32, 0x2p-56)));
    try std.testing.expectEqual(0x1.715476p-60, log2p1(@as(f32, 0x1p-60)));
    try std.testing.expectEqual(0x1.715476p-100, log2p1(@as(f32, 0x1p-100)));
    try std.testing.expectEqual(0x8p-152, log2p1(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(0x8p-152, log2p1(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(0x5.c551d8p-128, log2p1(@as(f32, 0x4p-128)));
    try std.testing.expectEqual(0x8p-152, log2p1(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(-0x5.c551d8p-128, log2p1(@as(f32, -0x4p-128)));
    try std.testing.expectEqual(-0x8p-152, log2p1(@as(f32, -0x8p-152)));
    // try std.testing.expectEqual(0xa.005c5p+0, log2p1(@as(f32, 0x4p+8)));
    try std.testing.expectEqual(0x1.400002p+4, log2p1(@as(f32, 0x1p+20)));
    // try std.testing.expectEqual(0x1.ep+4, log2p1(@as(f32, 0x4p+28)));
    try std.testing.expectEqual(0x3.2p+4, log2p1(@as(f32, 0x4p+48)));
    // try std.testing.expectEqual(0x3.cp+4, log2p1(@as(f32, 0x1p+60)));
    try std.testing.expectEqual(0x6.4p+4, log2p1(@as(f32, 0x1p+100)));
    try std.testing.expectEqual(0x8p+4, log2p1(@as(f32, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x8.0031ep-4, log2p1(@as(f32, 0x6.a0cf48p-4)));
    try std.testing.expectEqual(0x8.0031dp-4, log2p1(@as(f32, 0x6.a0cf4p-4)));
    try std.testing.expectEqual(0x8p+4, log2p1(@as(f32, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x7.f9adf8p-4, log2p1(@as(f32, 0x6.9a6d28p-4)));
    // try std.testing.expectEqual(0x7.fe351p-4, log2p1(@as(f32, 0x6.9edc98p-4)));
    try std.testing.expectEqual(0x7.fe3508p-4, log2p1(@as(f32, 0x6.9edc9p-4)));
    try std.testing.expectEqual(0x7.35ab48p-4, log2p1(@as(f32, 0x5.dda3a8p-4)));
    // try std.testing.expectEqual(0x7.35ab4p-4, log2p1(@as(f32, 0x5.dda3ap-4)));
    try std.testing.expectEqual(-0xf.ffdc5p-4, log2p1(@as(f32, -0x7.fff3ap-4)));
    try std.testing.expectEqual(-0xf.ffdc6p-4, log2p1(@as(f32, -0x7.fff3a8p-4)));
    try std.testing.expectEqual(0x8.8ac64p-4, log2p1(@as(f32, 0x7.2a4368p-4)));
    try std.testing.expectEqual(0x8.33cf6p-4, log2p1(@as(f32, 0x6.d3a118p-4)));
    // try std.testing.expectEqual(0x2.96b2bp+0, log2p1(@as(f32, 0x5.03f228p+0)));
    // try std.testing.expectEqual(0x8.86cf8p-4, log2p1(@as(f32, 0x7.264968p-4)));
    try std.testing.expectEqual(0x8.86cf7p-4, log2p1(@as(f32, 0x7.26496p-4)));
    try std.testing.expectEqual(0x9.ceb4ep-4, log2p1(@as(f32, 0x8.786bdp-4)));
    // try std.testing.expectEqual(0x8.e945ep-4, log2p1(@as(f32, 0x7.89dc18p-4)));
    try std.testing.expectEqual(0x8.e945dp-4, log2p1(@as(f32, 0x7.89dc1p-4)));
    try std.testing.expectEqual(0xa.c3e25p-4, log2p1(@as(f32, 0x9.81cdp-4)));
    try std.testing.expectEqual(0xa.c3e24p-4, log2p1(@as(f32, 0x9.81ccfp-4)));
    try std.testing.expectEqual(0xb.7bbdcp-4, log2p1(@as(f32, 0xa.50287p-4)));
    try std.testing.expectEqual(0xb.7bbdbp-4, log2p1(@as(f32, 0xa.50286p-4)));
    // try std.testing.expectEqual(0x7.15bc2p-4, log2p1(@as(f32, 0x5.bf7888p-4)));
    try std.testing.expectEqual(0x7.15bc18p-4, log2p1(@as(f32, 0x5.bf788p-4)));
    try std.testing.expectEqual(0x9.0904bp-4, log2p1(@as(f32, 0x7.aa5198p-4)));
    try std.testing.expectEqual(0x1.bd160cp+0, log2p1(@as(f32, 0x2.564fap+0)));
    try std.testing.expectEqual(0x9.584b4p-4, log2p1(@as(f32, 0x7.fc243p-4)));
    try std.testing.expectEqual(0x9.584b4p-4, log2p1(@as(f32, 0x7.fc2428p-4)));
    try std.testing.expectEqual(-0x8.8bf9p-4, log2p1(@as(f32, -0x4.f37d38p-4)));
    try std.testing.expectEqual(-0x8.8bf91p-4, log2p1(@as(f32, -0x4.f37d4p-4)));
    try std.testing.expectEqual(0x8.8f48ap-4, log2p1(@as(f32, 0x7.2eca58p-4)));
    try std.testing.expectEqual(0x8.8f489p-4, log2p1(@as(f32, 0x7.2eca5p-4)));
    // try std.testing.expectEqual(-0xb.6ed64p-4, log2p1(@as(f32, -0x6.3fef3p-4)));
    // try std.testing.expectEqual(-0xb.6ed66p-4, log2p1(@as(f32, -0x6.3fef38p-4)));
    // try std.testing.expectEqual(0x8.0efc7p-4, log2p1(@as(f32, 0x6.af53d8p-4)));
    try std.testing.expectEqual(0x8.0efc6p-4, log2p1(@as(f32, 0x6.af53dp-4)));

    try std.testing.expectEqual(0x0p+0, log2p1(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, log2p1(@as(f64, -0x0p+0)));
    try std.testing.expectEqual(0x1.715476a649bcep+0, log2p1(@as(f64, 0x1.b7e152p+0)));
    try std.testing.expectEqual(0x1.715475968cddcp+0, log2p1(@as(f64, 0x1.b7e15p+0)));
    try std.testing.expectEqual(0x1.71547652b82fep+0, log2p1(@as(f64, 0x1.b7e151628aed3p+0)));
    try std.testing.expectEqual(0x1.71547652b82fep+0, log2p1(@as(f64, 0x1.b7e151628aed2p+0)));
    // try std.testing.expectEqual(-0x6.a3fe5c6042978p-4, log2p1(@as(f64, -0x4p-4)));
    // try std.testing.expectEqual(-0x3p+0, log2p1(@as(f64, -0xep-4)));
    try std.testing.expectEqual(0xb.5d69bac77ec38p-8, log2p1(@as(f64, 0x8p-8)));
    try std.testing.expectEqual(0x5.c4994dd0fd15p-12, log2p1(@as(f64, 0x4p-12)));
    try std.testing.expectEqual(0x2.e2a60a005c95cp-16, log2p1(@as(f64, 0x2p-16)));
    // try std.testing.expectEqual(0x1.71546ac814f86p-20, log2p1(@as(f64, 0x1p-20)));
    try std.testing.expectEqual(0xb.8aa3afb318938p-28, log2p1(@as(f64, 0x8p-28)));
    try std.testing.expectEqual(0x5.c551d93f561bcp-32, log2p1(@as(f64, 0x4p-32)));
    try std.testing.expectEqual(0x2.e2a8eca542354p-36, log2p1(@as(f64, 0x2p-36)));
    try std.testing.expectEqual(0x1.71547652b7773p-40, log2p1(@as(f64, 0x1p-40)));
    try std.testing.expectEqual(0xb.8aa3b295c151p-48, log2p1(@as(f64, 0x8p-48)));
    try std.testing.expectEqual(0x5.c551d94ae0becp-52, log2p1(@as(f64, 0x4p-52)));
    try std.testing.expectEqual(0x2.e2a8eca5705fcp-56, log2p1(@as(f64, 0x2p-56)));
    try std.testing.expectEqual(0x1.71547652b82fep-60, log2p1(@as(f64, 0x1p-60)));
    try std.testing.expectEqual(0x1.71547652b82fep-100, log2p1(@as(f64, 0x1p-100)));
    try std.testing.expectEqual(0xb.8aa3b295c17fp-152, log2p1(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(0x1.71547652b82fep-600, log2p1(@as(f64, 0x1p-600)));
    try std.testing.expectEqual(0xb.8aa3b295c17fp-152, log2p1(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(0x4p-1076, log2p1(@as(f64, 0x4p-1076)));
    try std.testing.expectEqual(0x5.c551d94ae0bf8p-128, log2p1(@as(f64, 0x4p-128)));
    try std.testing.expectEqual(0x5.c551d94ae0bf8p-1024, log2p1(@as(f64, 0x4p-1024)));
    try std.testing.expectEqual(0xb.8aa3b295c17fp-972, log2p1(@as(f64, 0x8p-972)));
    try std.testing.expectEqual(0xb.8aa3b295c17fp-152, log2p1(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x4p-1076, log2p1(@as(f64, 0x4p-1076)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf8p-128, log2p1(@as(f64, -0x4p-128)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf8p-1024, log2p1(@as(f64, -0x4p-1024)));
    try std.testing.expectEqual(-0xb.8aa3b295c17fp-972, log2p1(@as(f64, -0x8p-972)));
    try std.testing.expectEqual(-0xb.8aa3b295c17fp-152, log2p1(@as(f64, -0x8p-152)));
    try std.testing.expectEqual(-0x4p-1076, log2p1(@as(f64, -0x4p-1076)));
    try std.testing.expectEqual(0xa.005c4994dd1p+0, log2p1(@as(f64, 0x4p+8)));
    // try std.testing.expectEqual(0x1.40000171546adp+4, log2p1(@as(f64, 0x1p+20)));
    // try std.testing.expectEqual(0x1.e00000005c552p+4, log2p1(@as(f64, 0x4p+28)));
    try std.testing.expectEqual(0x3.2p+4, log2p1(@as(f64, 0x4p+48)));
    try std.testing.expectEqual(0x3.cp+4, log2p1(@as(f64, 0x1p+60)));
    try std.testing.expectEqual(0x6.4p+4, log2p1(@as(f64, 0x1p+100)));
    try std.testing.expectEqual(0x7.ffffffe8eab88p+4, log2p1(@as(f64, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x3.e8p+8, log2p1(@as(f64, 0x1p+1000)));
    try std.testing.expectEqual(0x8.0031dd4ec0d9p-4, log2p1(@as(f64, 0x6.a0cf48p-4)));
    try std.testing.expectEqual(0x8.0031d525939ap-4, log2p1(@as(f64, 0x6.a0cf4p-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc8p-4, log2p1(@as(f64, 0x6.a0cf42befceap-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dcp-4, log2p1(@as(f64, 0x6.a0cf42befce9cp-4)));
    try std.testing.expectEqual(0x7.ffffffe8eab88p+4, log2p1(@as(f64, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x4p+8, log2p1(@as(f64, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x7.f9adf705b1a88p-4, log2p1(@as(f64, 0x6.9a6d28p-4)));
    // try std.testing.expectEqual(0x7.fe35109dc38fcp-4, log2p1(@as(f64, 0x6.9edc98p-4)));
    try std.testing.expectEqual(0x7.fe350873e2674p-4, log2p1(@as(f64, 0x6.9edc9p-4)));
    try std.testing.expectEqual(0x7.fe350e72e4da4p-4, log2p1(@as(f64, 0x6.9edc95e03fcbp-4)));
    try std.testing.expectEqual(0x7.35ab49a4f4be8p-4, log2p1(@as(f64, 0x5.dda3a8p-4)));
    // try std.testing.expectEqual(0x7.35ab4132efd7cp-4, log2p1(@as(f64, 0x5.dda3ap-4)));
    try std.testing.expectEqual(0x7.35ab434394f64p-4, log2p1(@as(f64, 0x5.dda3a1f4c4024p-4)));
    try std.testing.expectEqual(0x7.35ab434394f6p-4, log2p1(@as(f64, 0x5.dda3a1f4c402p-4)));
    try std.testing.expectEqual(-0xf.ffdc4b312d518p-4, log2p1(@as(f64, -0x7.fff3ap-4)));
    try std.testing.expectEqual(-0xf.ffdc6246510d8p-4, log2p1(@as(f64, -0x7.fff3a8p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152p-4, log2p1(@as(f64, -0x7.fff3a57fdd264p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5153p-4, log2p1(@as(f64, -0x7.fff3a57fdd268p-4)));
    try std.testing.expectEqual(0x8.8ac6393d19ee8p-4, log2p1(@as(f64, 0x7.2a4368p-4)));
    try std.testing.expectEqual(0x8.33cf5fc55708p-4, log2p1(@as(f64, 0x6.d3a118p-4)));
    try std.testing.expectEqual(0x2.96b2aea66dc4ap+0, log2p1(@as(f64, 0x5.03f228p+0)));
    try std.testing.expectEqual(0x8.86cf7c4d6b2ap-4, log2p1(@as(f64, 0x7.264968p-4)));
    try std.testing.expectEqual(0x8.86cf74534bdp-4, log2p1(@as(f64, 0x7.26496p-4)));
    try std.testing.expectEqual(0x8.86cf77d93e0ap-4, log2p1(@as(f64, 0x7.264963888ac9p-4)));
    try std.testing.expectEqual(0x9.ceb4e6b738158p-4, log2p1(@as(f64, 0x8.786bdp-4)));
    try std.testing.expectEqual(0x8.e945d9046f2a8p-4, log2p1(@as(f64, 0x7.89dc18p-4)));
    try std.testing.expectEqual(0x8.e945d12c0e6fp-4, log2p1(@as(f64, 0x7.89dc1p-4)));
    try std.testing.expectEqual(0x8.e945d8801a6b8p-4, log2p1(@as(f64, 0x7.89dc17790eeb4p-4)));
    try std.testing.expectEqual(0xa.c3e2530f0a4dp-4, log2p1(@as(f64, 0x9.81cdp-4)));
    // try std.testing.expectEqual(0xa.c3e2449447a5p-4, log2p1(@as(f64, 0x9.81ccfp-4)));
    try std.testing.expectEqual(0xa.c3e24c4d2cc98p-4, log2p1(@as(f64, 0x9.81ccf8887c25p-4)));
    // try std.testing.expectEqual(0xa.c3e24c4d2cc9p-4, log2p1(@as(f64, 0x9.81ccf8887c248p-4)));
    try std.testing.expectEqual(0xb.7bbdbf42ba38p-4, log2p1(@as(f64, 0xa.50287p-4)));
    try std.testing.expectEqual(0xb.7bbdb1398559p-4, log2p1(@as(f64, 0xa.50286p-4)));
    try std.testing.expectEqual(0xb.7bbdb1b431638p-4, log2p1(@as(f64, 0xa.5028608bd65f8p-4)));
    try std.testing.expectEqual(0xb.7bbdb1b43163p-4, log2p1(@as(f64, 0xa.5028608bd65fp-4)));
    // try std.testing.expectEqual(0x7.15bc23e74543p-4, log2p1(@as(f64, 0x5.bf7888p-4)));
    try std.testing.expectEqual(0x7.15bc1b69893cp-4, log2p1(@as(f64, 0x5.bf788p-4)));
    try std.testing.expectEqual(0x7.15bc23197ed74p-4, log2p1(@as(f64, 0x5.bf78873e20a3p-4)));
    // try std.testing.expectEqual(0x7.15bc23197ed7p-4, log2p1(@as(f64, 0x5.bf78873e20a2cp-4)));
    // try std.testing.expectEqual(0x9.0904b79f424e8p-4, log2p1(@as(f64, 0x7.aa5198p-4)));
    // try std.testing.expectEqual(0x1.bd160b24ed663p+0, log2p1(@as(f64, 0x2.564fap+0)));
    try std.testing.expectEqual(0x9.584b4411ad528p-4, log2p1(@as(f64, 0x7.fc243p-4)));
    try std.testing.expectEqual(0x9.584b3c5eadf6p-4, log2p1(@as(f64, 0x7.fc2428p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad8p-4, log2p1(@as(f64, 0x7.fc242a2235224p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad8p-4, log2p1(@as(f64, 0x7.fc242a223522p-4)));
    try std.testing.expectEqual(-0x8.8bf8fda354458p-4, log2p1(@as(f64, -0x4.f37d38p-4)));
    try std.testing.expectEqual(-0x8.8bf90e59fa42p-4, log2p1(@as(f64, -0x4.f37d4p-4)));
    try std.testing.expectEqual(-0x8.8bf9074666538p-4, log2p1(@as(f64, -0x4.f37d3c9ce0b14p-4)));
    try std.testing.expectEqual(-0x8.8bf907466654p-4, log2p1(@as(f64, -0x4.f37d3c9ce0b18p-4)));
    try std.testing.expectEqual(0x8.8f489e9ced98p-4, log2p1(@as(f64, 0x7.2eca58p-4)));
    try std.testing.expectEqual(0x8.8f4896a5bb5p-4, log2p1(@as(f64, 0x7.2eca5p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe3p-4, log2p1(@as(f64, 0x7.2eca50c4d931cp-4)));
    try std.testing.expectEqual(0x8.8f489769bbe28p-4, log2p1(@as(f64, 0x7.2eca50c4d9318p-4)));
    try std.testing.expectEqual(-0xb.6ed647a6fb358p-4, log2p1(@as(f64, -0x6.3fef3p-4)));
    try std.testing.expectEqual(-0xb.6ed65a977e3p-4, log2p1(@as(f64, -0x6.3fef38p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368p-4, log2p1(@as(f64, -0x6.3fef3067427e4p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b7137p-4, log2p1(@as(f64, -0x6.3fef3067427e8p-4)));
    try std.testing.expectEqual(0x8.0efc689b81d38p-4, log2p1(@as(f64, 0x6.af53d8p-4)));
    try std.testing.expectEqual(0x8.0efc60778d9b8p-4, log2p1(@as(f64, 0x6.af53dp-4)));
    try std.testing.expectEqual(0x8.0efc6087a73cp-4, log2p1(@as(f64, 0x6.af53d00fd2848p-4)));
    try std.testing.expectEqual(0x8.0efc6087a73b8p-4, log2p1(@as(f64, 0x6.af53d00fd2844p-4)));

    try std.testing.expectEqual(0x0p+0, log2p1(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, log2p1(@as(f80, -0x0p+0)));
    try std.testing.expectEqual(0x1.715476a649bcdd1p+0, log2p1(@as(f80, 0x1.b7e152p+0)));
    // try std.testing.expectEqual(0x1.715475968cddc4e6p+0, log2p1(@as(f80, 0x1.b7e15p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe46ep+0, log2p1(@as(f80, 0x1.b7e151628aed3p+0)));
    try std.testing.expectEqual(0x1.71547652b82fdbfp+0, log2p1(@as(f80, 0x1.b7e151628aed2p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe178p+0, log2p1(@as(f80, 0x1.b7e151628aed2a6cp+0)));
    try std.testing.expectEqual(0x1.71547652b82fe178p+0, log2p1(@as(f80, 0x1.b7e151628aed2a6ap+0)));
    try std.testing.expectEqual(-0x6.a3fe5c6042978608p-4, log2p1(@as(f80, -0x4p-4)));
    try std.testing.expectEqual(-0x3p+0, log2p1(@as(f80, -0xep-4)));
    try std.testing.expectEqual(0xb.5d69bac77ec398ap-8, log2p1(@as(f80, 0x8p-8)));
    try std.testing.expectEqual(0x5.c4994dd0fd1507e8p-12, log2p1(@as(f80, 0x4p-12)));
    // try std.testing.expectEqual(0x2.e2a60a005c95c8ccp-16, log2p1(@as(f80, 0x2p-16)));
    try std.testing.expectEqual(0x1.71546ac814f867d8p-20, log2p1(@as(f80, 0x1p-20)));
    try std.testing.expectEqual(0xb.8aa3afb318935c8p-28, log2p1(@as(f80, 0x8p-28)));
    try std.testing.expectEqual(0x5.c551d93f561bd368p-32, log2p1(@as(f80, 0x4p-32)));
    try std.testing.expectEqual(0x2.e2a8eca542353424p-36, log2p1(@as(f80, 0x2p-36)));
    try std.testing.expectEqual(0x1.71547652b777373cp-40, log2p1(@as(f80, 0x1p-40)));
    try std.testing.expectEqual(0xb.8aa3b295c150e13p-48, log2p1(@as(f80, 0x8p-48)));
    // try std.testing.expectEqual(0x5.c551d94ae0becd3p-52, log2p1(@as(f80, 0x4p-52)));
    try std.testing.expectEqual(0x2.e2a8eca5705fc00cp-56, log2p1(@as(f80, 0x2p-56)));
    try std.testing.expectEqual(0x1.71547652b82fe16cp-60, log2p1(@as(f80, 0x1p-60)));
    try std.testing.expectEqual(0x1.71547652b82fe178p-100, log2p1(@as(f80, 0x1p-100)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bcp-152, log2p1(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe178p-600, log2p1(@as(f80, 0x1p-600)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bcp-152, log2p1(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ep-1076, log2p1(@as(f80, 0x4p-1076)));
    try std.testing.expectEqual(0x1.71547652b82fe178p-10000, log2p1(@as(f80, 0x1p-10000)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ep-128, log2p1(@as(f80, 0x4p-128)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ep-1024, log2p1(@as(f80, 0x4p-1024)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ep-16384, log2p1(@as(f80, 0x4p-16384)));
    try std.testing.expectEqual(0x2.e2a8eca5705fc2fp-16384, log2p1(@as(f80, 0x2p-16384)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bcp-972, log2p1(@as(f80, 0x8p-972)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bcp-152, log2p1(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ep-1076, log2p1(@as(f80, 0x4p-1076)));
    try std.testing.expectEqual(0x8p-16448, log2p1(@as(f80, 0x8p-16448)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ep-128, log2p1(@as(f80, -0x4p-128)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ep-1024, log2p1(@as(f80, -0x4p-1024)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ep-16384, log2p1(@as(f80, -0x4p-16384)));
    try std.testing.expectEqual(-0x2.e2a8eca5705fc2fp-16384, log2p1(@as(f80, -0x2p-16384)));
    try std.testing.expectEqual(-0xb.8aa3b295c17f0bcp-972, log2p1(@as(f80, -0x8p-972)));
    try std.testing.expectEqual(-0xb.8aa3b295c17f0bcp-152, log2p1(@as(f80, -0x8p-152)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ep-1076, log2p1(@as(f80, -0x4p-1076)));
    try std.testing.expectEqual(-0x8p-16448, log2p1(@as(f80, -0x8p-16448)));
    try std.testing.expectEqual(0xa.005c4994dd0fd15p+0, log2p1(@as(f80, 0x4p+8)));
    // try std.testing.expectEqual(0x1.40000171546ac814p+4, log2p1(@as(f80, 0x1p+20)));
    // try std.testing.expectEqual(0x1.e00000005c551d94p+4, log2p1(@as(f80, 0x4p+28)));
    try std.testing.expectEqual(0x3.20000000000005c4p+4, log2p1(@as(f80, 0x4p+48)));
    try std.testing.expectEqual(0x3.cp+4, log2p1(@as(f80, 0x1p+60)));
    try std.testing.expectEqual(0x6.4p+4, log2p1(@as(f80, 0x1p+100)));
    // try std.testing.expectEqual(0x7.ffffffe8eab88f48p+4, log2p1(@as(f80, 0xf.fffffp+124)));
    // try std.testing.expectEqual(0x3.e8p+8, log2p1(@as(f80, 0x1p+1000)));
    try std.testing.expectEqual(0x8.0031dd4ec0d8f51p-4, log2p1(@as(f80, 0x6.a0cf48p-4)));
    try std.testing.expectEqual(0x8.0031d5259399e48p-4, log2p1(@as(f80, 0x6.a0cf4p-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc5b6p-4, log2p1(@as(f80, 0x6.a0cf42befceap-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc1a1p-4, log2p1(@as(f80, 0x6.a0cf42befce9cp-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc484p-4, log2p1(@as(f80, 0x6.a0cf42befce9ed48p-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc484p-4, log2p1(@as(f80, 0x6.a0cf42befce9ed4p-4)));
    // try std.testing.expectEqual(0x7.ffffffe8eab88f48p+4, log2p1(@as(f80, 0xf.fffffp+124)));
    // try std.testing.expectEqual(0x3.fffffffffffffff4p+8, log2p1(@as(f80, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x4p+12, log2p1(@as(f80, 0xf.fffffffffffffffp+16380)));
    try std.testing.expectEqual(0x7.f9adf705b1a88708p-4, log2p1(@as(f80, 0x6.9a6d28p-4)));
    try std.testing.expectEqual(0x7.fe35109dc38fc328p-4, log2p1(@as(f80, 0x6.9edc98p-4)));
    // try std.testing.expectEqual(0x7.fe350873e2673068p-4, log2p1(@as(f80, 0x6.9edc9p-4)));
    try std.testing.expectEqual(0x7.fe350e72e4da381p-4, log2p1(@as(f80, 0x6.9edc95e03fcbp-4)));
    try std.testing.expectEqual(0x7.35ab49a4f4be7458p-4, log2p1(@as(f80, 0x5.dda3a8p-4)));
    try std.testing.expectEqual(0x7.35ab4132efd7c8e8p-4, log2p1(@as(f80, 0x5.dda3ap-4)));
    // try std.testing.expectEqual(0x7.35ab434394f63af8p-4, log2p1(@as(f80, 0x5.dda3a1f4c4024p-4)));
    try std.testing.expectEqual(0x7.35ab434394f5f768p-4, log2p1(@as(f80, 0x5.dda3a1f4c402p-4)));
    // try std.testing.expectEqual(0x7.35ab434394f606e8p-4, log2p1(@as(f80, 0x5.dda3a1f4c4020ebp-4)));
    // try std.testing.expectEqual(-0xf.ffdc4b312d5189ap-4, log2p1(@as(f80, -0x7.fff3ap-4)));
    // try std.testing.expectEqual(-0xf.ffdc6246510d8c7p-4, log2p1(@as(f80, -0x7.fff3a8p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152318p-4, log2p1(@as(f80, -0x7.fff3a57fdd264p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152ea2p-4, log2p1(@as(f80, -0x7.fff3a57fdd268p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152a13p-4, log2p1(@as(f80, -0x7.fff3a57fdd2666b8p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152a15p-4, log2p1(@as(f80, -0x7.fff3a57fdd2666cp-4)));
    try std.testing.expectEqual(0x8.8ac6393d19ee6b2p-4, log2p1(@as(f80, 0x7.2a4368p-4)));
    try std.testing.expectEqual(0x8.33cf5fc55707e24p-4, log2p1(@as(f80, 0x6.d3a118p-4)));
    try std.testing.expectEqual(0x2.96b2aea66dc4abe8p+0, log2p1(@as(f80, 0x5.03f228p+0)));
    try std.testing.expectEqual(0x8.86cf7c4d6b29ea2p-4, log2p1(@as(f80, 0x7.264968p-4)));
    try std.testing.expectEqual(0x8.86cf74534bd01d7p-4, log2p1(@as(f80, 0x7.26496p-4)));
    try std.testing.expectEqual(0x8.86cf77d93e0a20fp-4, log2p1(@as(f80, 0x7.264963888ac9p-4)));
    // try std.testing.expectEqual(0x9.ceb4e6b73815a5p-4, log2p1(@as(f80, 0x8.786bdp-4)));
    try std.testing.expectEqual(0x8.e945d9046f2a40cp-4, log2p1(@as(f80, 0x7.89dc18p-4)));
    try std.testing.expectEqual(0x8.e945d12c0e6ee7p-4, log2p1(@as(f80, 0x7.89dc1p-4)));
    try std.testing.expectEqual(0x8.e945d8801a6b586p-4, log2p1(@as(f80, 0x7.89dc17790eeb4p-4)));
    try std.testing.expectEqual(0xa.c3e2530f0a4cef6p-4, log2p1(@as(f80, 0x9.81cdp-4)));
    try std.testing.expectEqual(0xa.c3e2449447a52b6p-4, log2p1(@as(f80, 0x9.81ccfp-4)));
    try std.testing.expectEqual(0xa.c3e24c4d2cc9a13p-4, log2p1(@as(f80, 0x9.81ccf8887c25p-4)));
    try std.testing.expectEqual(0xa.c3e24c4d2cc92d6p-4, log2p1(@as(f80, 0x9.81ccf8887c248p-4)));
    try std.testing.expectEqual(0xa.c3e24c4d2cc9514p-4, log2p1(@as(f80, 0x9.81ccf8887c24a7bp-4)));
    try std.testing.expectEqual(0xb.7bbdbf42ba381e1p-4, log2p1(@as(f80, 0xa.50287p-4)));
    // try std.testing.expectEqual(0xb.7bbdb1398559009p-4, log2p1(@as(f80, 0xa.50286p-4)));
    try std.testing.expectEqual(0xb.7bbdb1b4316361p-4, log2p1(@as(f80, 0xa.5028608bd65f8p-4)));
    try std.testing.expectEqual(0xb.7bbdb1b43162f0cp-4, log2p1(@as(f80, 0xa.5028608bd65fp-4)));
    try std.testing.expectEqual(0xb.7bbdb1b43163229p-4, log2p1(@as(f80, 0xa.5028608bd65f38dp-4)));
    // try std.testing.expectEqual(0x7.15bc23e74542ea98p-4, log2p1(@as(f80, 0x5.bf7888p-4)));
    try std.testing.expectEqual(0x7.15bc1b69893c17b8p-4, log2p1(@as(f80, 0x5.bf788p-4)));
    try std.testing.expectEqual(0x7.15bc23197ed75958p-4, log2p1(@as(f80, 0x5.bf78873e20a3p-4)));
    try std.testing.expectEqual(0x7.15bc23197ed71568p-4, log2p1(@as(f80, 0x5.bf78873e20a2cp-4)));
    // try std.testing.expectEqual(0x7.15bc23197ed72b1p-4, log2p1(@as(f80, 0x5.bf78873e20a2d468p-4)));
    try std.testing.expectEqual(0x9.0904b79f424e4fap-4, log2p1(@as(f80, 0x7.aa5198p-4)));
    // try std.testing.expectEqual(0x1.bd160b24ed662fd8p+0, log2p1(@as(f80, 0x2.564fap+0)));
    try std.testing.expectEqual(0x9.584b4411ad52726p-4, log2p1(@as(f80, 0x7.fc243p-4)));
    try std.testing.expectEqual(0x9.584b3c5eadf61bbp-4, log2p1(@as(f80, 0x7.fc2428p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad8c3p-4, log2p1(@as(f80, 0x7.fc242a2235224p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad4e9p-4, log2p1(@as(f80, 0x7.fc242a223522p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad7bdp-4, log2p1(@as(f80, 0x7.fc242a2235222ef8p-4)));
    try std.testing.expectEqual(-0x8.8bf8fda35445b83p-4, log2p1(@as(f80, -0x4.f37d38p-4)));
    try std.testing.expectEqual(-0x8.8bf90e59fa41d91p-4, log2p1(@as(f80, -0x4.f37d4p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653795p-4, log2p1(@as(f80, -0x4.f37d3c9ce0b14p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653ff1p-4, log2p1(@as(f80, -0x4.f37d3c9ce0b18p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653921p-4, log2p1(@as(f80, -0x4.f37d3c9ce0b14bd8p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653922p-4, log2p1(@as(f80, -0x4.f37d3c9ce0b14bep-4)));
    try std.testing.expectEqual(0x8.8f489e9ced97eb5p-4, log2p1(@as(f80, 0x7.2eca58p-4)));
    try std.testing.expectEqual(0x8.8f4896a5bb50057p-4, log2p1(@as(f80, 0x7.2eca5p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe2c2ap-4, log2p1(@as(f80, 0x7.2eca50c4d931cp-4)));
    try std.testing.expectEqual(0x8.8f489769bbe282ep-4, log2p1(@as(f80, 0x7.2eca50c4d9318p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe299p-4, log2p1(@as(f80, 0x7.2eca50c4d9319638p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe299p-4, log2p1(@as(f80, 0x7.2eca50c4d931963p-4)));
    try std.testing.expectEqual(-0xb.6ed647a6fb356e7p-4, log2p1(@as(f80, -0x6.3fef3p-4)));
    try std.testing.expectEqual(-0xb.6ed65a977e2fd7ep-4, log2p1(@as(f80, -0x6.3fef38p-4)));
    // try std.testing.expectEqual(-0xb.6ed6489b7136836p-4, log2p1(@as(f80, -0x6.3fef3067427e4p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71371aep-4, log2p1(@as(f80, -0x6.3fef3067427e8p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368c8p-4, log2p1(@as(f80, -0x6.3fef3067427e43d8p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368c9p-4, log2p1(@as(f80, -0x6.3fef3067427e43ep-4)));
    try std.testing.expectEqual(0x8.0efc689b81d3602p-4, log2p1(@as(f80, 0x6.af53d8p-4)));
    try std.testing.expectEqual(0x8.0efc60778d9b537p-4, log2p1(@as(f80, 0x6.af53dp-4)));
    try std.testing.expectEqual(0x8.0efc6087a73bdd9p-4, log2p1(@as(f80, 0x6.af53d00fd2848p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73b9c7p-4, log2p1(@as(f80, 0x6.af53d00fd2844p-4)));
    try std.testing.expectEqual(0x8.0efc6087a73bba4p-4, log2p1(@as(f80, 0x6.af53d00fd2845d48p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba3p-4, log2p1(@as(f80, 0x6.af53d00fd2845d4p-4)));

    try std.testing.expectEqual(0x0p+0, log2p1(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, log2p1(@as(f128, -0x0p+0)));
    // try std.testing.expectEqual(0x1.715476a649bcdd1095ef715f7243p+0, log2p1(@as(f128, 0x1.b7e152p+0)));
    // try std.testing.expectEqual(0x1.715475968cddc4e6c2b1cbd1a7c8p+0, log2p1(@as(f128, 0x1.b7e15p+0)));
    // try std.testing.expectEqual(0x1.71547652b82fe46e0bf78d510ab9p+0, log2p1(@as(f128, 0x1.b7e151628aed3p+0)));
    // try std.testing.expectEqual(0x1.71547652b82fdbf024ffffda5e62p+0, log2p1(@as(f128, 0x1.b7e151628aed2p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe1782731bf3f6b29p+0, log2p1(@as(f128, 0x1.b7e151628aed2a6cp+0)));
    // try std.testing.expectEqual(0x1.71547652b82fe1771774e04dbc54p+0, log2p1(@as(f128, 0x1.b7e151628aed2a6ap+0)));
    // try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d23bp+0, log2p1(@as(f128, 0x1.b7e151628aed2a6abf7158809cf5p+0)));
    // try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d23ap+0, log2p1(@as(f128, 0x1.b7e151628aed2a6abf7158809cf4p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d24p+0, log2p1(@as(f128, 0x1.b7e151628aed2a6abf7158809dp+0)));
    try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d1fcp+0, log2p1(@as(f128, 0x1.b7e151628aed2a6abf7158809c8p+0)));
    try std.testing.expectEqual(-0x6.a3fe5c6042978605ff4edf5f9744p-4, log2p1(@as(f128, -0x4p-4)));
    // try std.testing.expectEqual(-0x3p+0, log2p1(@as(f128, -0xep-4)));
    // try std.testing.expectEqual(0xb.5d69bac77ec3989b03784b5be088p-8, log2p1(@as(f128, 0x8p-8)));
    // try std.testing.expectEqual(0x5.c4994dd0fd1507ea7e50e498deb8p-12, log2p1(@as(f128, 0x4p-12)));
    try std.testing.expectEqual(0x2.e2a60a005c95c8cdda0c94035caap-16, log2p1(@as(f128, 0x2p-16)));
    try std.testing.expectEqual(0x1.71546ac814f867d7a99ac240f178p-20, log2p1(@as(f128, 0x1p-20)));
    // try std.testing.expectEqual(0xb.8aa3afb318935c83d742790eedcp-28, log2p1(@as(f128, 0x8p-28)));
    try std.testing.expectEqual(0x5.c551d93f561bd366f9cac6a50f48p-32, log2p1(@as(f128, 0x4p-32)));
    // try std.testing.expectEqual(0x2.e2a8eca542353424a6f2e04e3bb8p-36, log2p1(@as(f128, 0x2p-36)));
    try std.testing.expectEqual(0x1.71547652b777373c53b460cc3dedp-40, log2p1(@as(f128, 0x1p-40)));
    try std.testing.expectEqual(0xb.8aa3b295c150e12d1e28e8009b3p-48, log2p1(@as(f128, 0x8p-48)));
    try std.testing.expectEqual(0x5.c551d94ae0becd33b9169a6b76f4p-52, log2p1(@as(f128, 0x4p-52)));
    try std.testing.expectEqual(0x2.e2a8eca5705fc00c513355d144b6p-56, log2p1(@as(f128, 0x2p-56)));
    try std.testing.expectEqual(0x1.71547652b82fe16bf26c4b0b10bbp-60, log2p1(@as(f128, 0x1p-60)));
    // try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0c6bp-100, log2p1(@as(f128, 0x1p-100)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bbbe87fed0691dp-152, log2p1(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d23ap-600, log2p1(@as(f128, 0x1p-600)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bbbe87fed0691dp-152, log2p1(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, log2p1(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ddf43ff68348e8p-1076, log2p1(@as(f128, 0x4p-1076)));
    try std.testing.expectEqual(0x1.71547652b82fe1777d0ffda0d23ap-10000, log2p1(@as(f128, 0x1p-10000)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ddf43ff68348e8p-128, log2p1(@as(f128, 0x4p-128)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ddf43ff68348e8p-1024, log2p1(@as(f128, 0x4p-1024)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ddf43ff68348e8p-16384, log2p1(@as(f128, 0x4p-16384)));
    try std.testing.expectEqual(0x2.e2a8eca5705fc2eefa1ffb41a474p-16384, log2p1(@as(f128, 0x2p-16384)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bbbe87fed0691dp-972, log2p1(@as(f128, 0x8p-972)));
    try std.testing.expectEqual(0xb.8aa3b295c17f0bbbe87fed0691dp-152, log2p1(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x5.c551d94ae0bf85ddf43ff68348e8p-1076, log2p1(@as(f128, 0x4p-1076)));
    try std.testing.expectEqual(0xb.8aa3b295c18p-16448, log2p1(@as(f128, 0x8p-16448)));
    try std.testing.expectEqual(0x5.c551d94ae0cp-16448, log2p1(@as(f128, 0x4p-16448)));
    try std.testing.expectEqual(0x4p-16496, log2p1(@as(f128, 0x4p-16496)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ddf43ff68348e8p-128, log2p1(@as(f128, -0x4p-128)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ddf43ff68348e8p-1024, log2p1(@as(f128, -0x4p-1024)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ddf43ff68348e8p-16384, log2p1(@as(f128, -0x4p-16384)));
    try std.testing.expectEqual(-0x2.e2a8eca5705fc2eefa1ffb41a474p-16384, log2p1(@as(f128, -0x2p-16384)));
    try std.testing.expectEqual(-0xb.8aa3b295c17f0bbbe87fed0691dp-972, log2p1(@as(f128, -0x8p-972)));
    try std.testing.expectEqual(-0xb.8aa3b295c17f0bbbe87fed0691dp-152, log2p1(@as(f128, -0x8p-152)));
    try std.testing.expectEqual(-0x5.c551d94ae0bf85ddf43ff68348e8p-1076, log2p1(@as(f128, -0x4p-1076)));
    try std.testing.expectEqual(-0xb.8aa3b295c18p-16448, log2p1(@as(f128, -0x8p-16448)));
    try std.testing.expectEqual(-0x5.c551d94ae0cp-16448, log2p1(@as(f128, -0x4p-16448)));
    try std.testing.expectEqual(-0x4p-16496, log2p1(@as(f128, -0x4p-16496)));
    try std.testing.expectEqual(0xa.005c4994dd0fd1507ea7e50e499p+0, log2p1(@as(f128, 0x4p+8)));
    // try std.testing.expectEqual(0x1.40000171546ac814f867d7a99ac2p+4, log2p1(@as(f128, 0x1p+20)));
    // try std.testing.expectEqual(0x1.e00000005c551d93f561bd366f9dp+4, log2p1(@as(f128, 0x4p+28)));
    try std.testing.expectEqual(0x3.20000000000005c551d94ae0becep+4, log2p1(@as(f128, 0x4p+48)));
    try std.testing.expectEqual(0x3.c00000000000000171547652b83p+4, log2p1(@as(f128, 0x1p+60)));
    try std.testing.expectEqual(0x6.400000000000000000000000017p+4, log2p1(@as(f128, 0x1p+100)));
    try std.testing.expectEqual(0x7.ffffffe8eab88f49d947a104332p+4, log2p1(@as(f128, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x3.e8p+8, log2p1(@as(f128, 0x1p+1000)));
    // try std.testing.expectEqual(0x8.0031dd4ec0d8f50c69dcd5a6fa8p-4, log2p1(@as(f128, 0x6.a0cf48p-4)));
    // try std.testing.expectEqual(0x8.0031d5259399e483b6c7d6a7e5fp-4, log2p1(@as(f128, 0x6.a0cf4p-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc5b5d560332b9b7ep-4, log2p1(@as(f128, 0x6.a0cf42befceap-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc1a13ec0710450788p-4, log2p1(@as(f128, 0x6.a0cf42befce9cp-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc4844fd239425d6ep-4, log2p1(@as(f128, 0x6.a0cf42befce9ed48p-4)));
    try std.testing.expectEqual(0x8.0031d7f2b2dc483cd3f654a18848p-4, log2p1(@as(f128, 0x6.a0cf42befce9ed4p-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc483d5c970df96c18p-4, log2p1(@as(f128, 0x6.a0cf42befce9ed4085ef59254b48p-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc483d5c970df96cdp-4, log2p1(@as(f128, 0x6.a0cf42befce9ed4085ef59254cp-4)));
    // try std.testing.expectEqual(0x8.0031d7f2b2dc483d5c970df96ac8p-4, log2p1(@as(f128, 0x6.a0cf42befce9ed4085ef59254ap-4)));
    try std.testing.expectEqual(0x7.ffffffe8eab88f49d947a104332p+4, log2p1(@as(f128, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x3.fffffffffffffff4755c4d6a3e8p+8, log2p1(@as(f128, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x3.ffffffffffffffffffe8eab89ad4p+12, log2p1(@as(f128, 0xf.fffffffffffffffp+16380)));
    // try std.testing.expectEqual(0x4p+12, log2p1(@as(f128, 0xf.fffffffffffffffffffffffffff8p+16380)));
    try std.testing.expectEqual(0x3.fffffffffffffffa3aae26b51f4p+8, log2p1(@as(f128, 0xf.ffffffffffffbffffffffffffcp+1020)));
    try std.testing.expectEqual(0x7.f9adf705b1a8870743c5e1b02544p-4, log2p1(@as(f128, 0x6.9a6d28p-4)));
    try std.testing.expectEqual(0x7.fe35109dc38fc3250574e9194664p-4, log2p1(@as(f128, 0x6.9edc98p-4)));
    try std.testing.expectEqual(0x7.fe350873e2673065341a8d170d04p-4, log2p1(@as(f128, 0x6.9edc9p-4)));
    try std.testing.expectEqual(0x7.fe350e72e4da380c30e23bd613fcp-4, log2p1(@as(f128, 0x6.9edc95e03fcbp-4)));
    try std.testing.expectEqual(0x7.35ab49a4f4be74564ad9aacdde74p-4, log2p1(@as(f128, 0x5.dda3a8p-4)));
    // try std.testing.expectEqual(0x7.35ab4132efd7c8e78316d2c38d9cp-4, log2p1(@as(f128, 0x5.dda3ap-4)));
    // try std.testing.expectEqual(0x7.35ab434394f63af6724f85099054p-4, log2p1(@as(f128, 0x5.dda3a1f4c4024p-4)));
    try std.testing.expectEqual(0x7.35ab434394f5f7664b13d8d53cc4p-4, log2p1(@as(f128, 0x5.dda3a1f4c402p-4)));
    // try std.testing.expectEqual(0x7.35ab434394f606e7a014ca9a3f04p-4, log2p1(@as(f128, 0x5.dda3a1f4c4020ebp-4)));
    try std.testing.expectEqual(-0xf.ffdc4b312d5189a5b749e26cad6p-4, log2p1(@as(f128, -0x7.fff3ap-4)));
    try std.testing.expectEqual(-0xf.ffdc6246510d8c73c0f874f4bb48p-4, log2p1(@as(f128, -0x7.fff3a8p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152317b50908372a87p-4, log2p1(@as(f128, -0x7.fff3a57fdd264p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152ea246e93363ea058p-4, log2p1(@as(f128, -0x7.fff3a57fdd268p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152a132a098655dcd58p-4, log2p1(@as(f128, -0x7.fff3a57fdd2666b8p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152a149b5bc25b426d8p-4, log2p1(@as(f128, -0x7.fff3a57fdd2666cp-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152a140d63324fbcaap-4, log2p1(@as(f128, -0x7.fff3a57fdd2666bcecba33bd89f4p-4)));
    try std.testing.expectEqual(-0xf.ffdc5b0f5152a140d63324fbc5p-4, log2p1(@as(f128, -0x7.fff3a57fdd2666bcecba33bd88p-4)));
    // try std.testing.expectEqual(-0xf.ffdc5b0f5152a140d63324fbcac8p-4, log2p1(@as(f128, -0x7.fff3a57fdd2666bcecba33bd8ap-4)));
    // try std.testing.expectEqual(0x8.8ac6393d19ee6b1c76048fa0d978p-4, log2p1(@as(f128, 0x7.2a4368p-4)));
    // try std.testing.expectEqual(0x8.33cf5fc55707e247166db43908bp-4, log2p1(@as(f128, 0x6.d3a118p-4)));
    try std.testing.expectEqual(0x2.96b2aea66dc4abe7061d213ba8b6p+0, log2p1(@as(f128, 0x5.03f228p+0)));
    // try std.testing.expectEqual(0x8.86cf7c4d6b29ea1b7d2626b2b338p-4, log2p1(@as(f128, 0x7.264968p-4)));
    try std.testing.expectEqual(0x8.86cf74534bd01d760e529a8582ep-4, log2p1(@as(f128, 0x7.26496p-4)));
    // try std.testing.expectEqual(0x8.86cf77d93e0a20ef5722b8e1eb6p-4, log2p1(@as(f128, 0x7.264963888ac9p-4)));
    try std.testing.expectEqual(0x9.ceb4e6b73815a504dfa91fd4b5p-4, log2p1(@as(f128, 0x8.786bdp-4)));
    // try std.testing.expectEqual(0x8.e945d9046f2a40c7b47774b4feap-4, log2p1(@as(f128, 0x7.89dc18p-4)));
    // try std.testing.expectEqual(0x8.e945d12c0e6ee704f7b8b42201bp-4, log2p1(@as(f128, 0x7.89dc1p-4)));
    try std.testing.expectEqual(0x8.e945d8801a6b5862e21590e7459p-4, log2p1(@as(f128, 0x7.89dc17790eeb4p-4)));
    // try std.testing.expectEqual(0xa.c3e2530f0a4cef5e0347d0efa0bp-4, log2p1(@as(f128, 0x9.81cdp-4)));
    // try std.testing.expectEqual(0xa.c3e2449447a52b5c659a37210578p-4, log2p1(@as(f128, 0x9.81ccfp-4)));
    // try std.testing.expectEqual(0xa.c3e24c4d2cc9a130895186e12898p-4, log2p1(@as(f128, 0x9.81ccf8887c25p-4)));
    // try std.testing.expectEqual(0xa.c3e24c4d2cc92d5a7415d2a78558p-4, log2p1(@as(f128, 0x9.81ccf8887c248p-4)));
    // try std.testing.expectEqual(0xa.c3e24c4d2cc95144f4eb35a8e498p-4, log2p1(@as(f128, 0x9.81ccf8887c24a7bp-4)));
    try std.testing.expectEqual(0xb.7bbdbf42ba381e10534774e00828p-4, log2p1(@as(f128, 0xa.50287p-4)));
    try std.testing.expectEqual(0xb.7bbdb13985590093f2b14c2f5f38p-4, log2p1(@as(f128, 0xa.50286p-4)));
    // try std.testing.expectEqual(0xb.7bbdb1b431636105af693791577p-4, log2p1(@as(f128, 0xa.5028608bd65f8p-4)));
    try std.testing.expectEqual(0xb.7bbdb1b43162f0bc08507cda2d4p-4, log2p1(@as(f128, 0xa.5028608bd65fp-4)));
    try std.testing.expectEqual(0xb.7bbdb1b431632292b91ad6b9b998p-4, log2p1(@as(f128, 0xa.5028608bd65f38dp-4)));
    // try std.testing.expectEqual(0x7.15bc23e74542ea9bf00660a9d608p-4, log2p1(@as(f128, 0x5.bf7888p-4)));
    try std.testing.expectEqual(0x7.15bc1b69893c17b9285e030f2e2cp-4, log2p1(@as(f128, 0x5.bf788p-4)));
    try std.testing.expectEqual(0x7.15bc23197ed75958019f8398165p-4, log2p1(@as(f128, 0x5.bf78873e20a3p-4)));
    // try std.testing.expectEqual(0x7.15bc23197ed7156a21730d6484a8p-4, log2p1(@as(f128, 0x5.bf78873e20a2cp-4)));
    try std.testing.expectEqual(0x7.15bc23197ed72b12da0d3a94b60cp-4, log2p1(@as(f128, 0x5.bf78873e20a2d468p-4)));
    try std.testing.expectEqual(0x9.0904b79f424e4fa19cca66692bc8p-4, log2p1(@as(f128, 0x7.aa5198p-4)));
    // try std.testing.expectEqual(0x1.bd160b24ed662fd779d7c941f88bp+0, log2p1(@as(f128, 0x2.564fap+0)));
    try std.testing.expectEqual(0x9.584b4411ad527260f3ec4ffd4df8p-4, log2p1(@as(f128, 0x7.fc243p-4)));
    // try std.testing.expectEqual(0x9.584b3c5eadf61bb02d03d77ecf58p-4, log2p1(@as(f128, 0x7.fc2428p-4)));
    // try std.testing.expectEqual(0x9.584b3e6c59ad8c2efd0dca56beap-4, log2p1(@as(f128, 0x7.fc242a2235224p-4)));
    // try std.testing.expectEqual(0x9.584b3e6c59ad4e97022649d6042p-4, log2p1(@as(f128, 0x7.fc242a223522p-4)));
    try std.testing.expectEqual(0x9.584b3e6c59ad7bcaeb68ef447d08p-4, log2p1(@as(f128, 0x7.fc242a2235222ef8p-4)));
    try std.testing.expectEqual(-0x8.8bf8fda35445b82d038ee9e47308p-4, log2p1(@as(f128, -0x4.f37d38p-4)));
    try std.testing.expectEqual(-0x8.8bf90e59fa41d908a56c9443ab58p-4, log2p1(@as(f128, -0x4.f37d4p-4)));
    // try std.testing.expectEqual(-0x8.8bf907466653795421abe9044ce8p-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653ff0951945a5571dp-4, log2p1(@as(f128, -0x4.f37d3c9ce0b18p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653921289698cfcb0ep-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14bd8p-4)));
    // try std.testing.expectEqual(-0x8.8bf9074666539223400f8a0adb08p-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14bep-4)));
    // try std.testing.expectEqual(-0x8.8bf907466653921e156fc9a6bd28p-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14bdd86eb157df5d4p-4)));
    // try std.testing.expectEqual(-0x8.8bf907466653921e156fc9a6b958p-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14bdd86eb157df4p-4)));
    try std.testing.expectEqual(-0x8.8bf907466653921e156fc9a6bd8p-4, log2p1(@as(f128, -0x4.f37d3c9ce0b14bdd86eb157df6p-4)));
    // try std.testing.expectEqual(0x8.8f489e9ced97eb4fb36bd0d79178p-4, log2p1(@as(f128, 0x7.2eca58p-4)));
    try std.testing.expectEqual(0x8.8f4896a5bb50056aecc5c33c8d4p-4, log2p1(@as(f128, 0x7.2eca5p-4)));
    // try std.testing.expectEqual(0x8.8f489769bbe2c29ba809a31864p-4, log2p1(@as(f128, 0x7.2eca50c4d931cp-4)));
    // try std.testing.expectEqual(0x8.8f489769bbe282e215c19244ddbp-4, log2p1(@as(f128, 0x7.2eca50c4d9318p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe29901a26a571c4dp-4, log2p1(@as(f128, 0x7.2eca50c4d9319638p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe298f9ab380e1a329p-4, log2p1(@as(f128, 0x7.2eca50c4d931963p-4)));
    try std.testing.expectEqual(0x8.8f489769bbe298ffcfbd53ee1588p-4, log2p1(@as(f128, 0x7.2eca50c4d93196362b4f37f6e8dcp-4)));
    try std.testing.expectEqual(0x8.8f489769bbe298ffcfbd53ee16a8p-4, log2p1(@as(f128, 0x7.2eca50c4d93196362b4f37f6eap-4)));
    try std.testing.expectEqual(0x8.8f489769bbe298ffcfbd53ee14a8p-4, log2p1(@as(f128, 0x7.2eca50c4d93196362b4f37f6e8p-4)));
    try std.testing.expectEqual(-0xb.6ed647a6fb356e6aadb9fc6a6c9p-4, log2p1(@as(f128, -0x6.3fef3p-4)));
    // try std.testing.expectEqual(-0xb.6ed65a977e2fd7dc19362a6ea158p-4, log2p1(@as(f128, -0x6.3fef38p-4)));
    // try std.testing.expectEqual(-0xb.6ed6489b71368361a39160dadc5p-4, log2p1(@as(f128, -0x6.3fef3067427e4p-4)));
    // try std.testing.expectEqual(-0xb.6ed6489b71371ae5bb2cc860ed08p-4, log2p1(@as(f128, -0x6.3fef3067427e8p-4)));
    // try std.testing.expectEqual(-0xb.6ed6489b71368c7b327c56328978p-4, log2p1(@as(f128, -0x6.3fef3067427e43d8p-4)));
    // try std.testing.expectEqual(-0xb.6ed6489b71368c8e22ff499f7a38p-4, log2p1(@as(f128, -0x6.3fef3067427e43ep-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368c8dac6bc0cfc918p-4, log2p1(@as(f128, -0x6.3fef3067427e43dfcde9e48f74bcp-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368c8dac6bc0cfc758p-4, log2p1(@as(f128, -0x6.3fef3067427e43dfcde9e48f74p-4)));
    try std.testing.expectEqual(-0xb.6ed6489b71368c8dac6bc0cfcc18p-4, log2p1(@as(f128, -0x6.3fef3067427e43dfcde9e48f76p-4)));
    try std.testing.expectEqual(0x8.0efc689b81d36019c0e4142aafbp-4, log2p1(@as(f128, 0x6.af53d8p-4)));
    // try std.testing.expectEqual(0x8.0efc60778d9b536b1d88afb8bc28p-4, log2p1(@as(f128, 0x6.af53dp-4)));
    try std.testing.expectEqual(0x8.0efc6087a73bdd9037f33081abdp-4, log2p1(@as(f128, 0x6.af53d00fd2848p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73b9c7096277cc7bcd8p-4, log2p1(@as(f128, 0x6.af53d00fd2844p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba3c2f0dcf622e68p-4, log2p1(@as(f128, 0x6.af53d00fd2845d48p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba340b1995ebb728p-4, log2p1(@as(f128, 0x6.af53d00fd2845d4p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba3b9eb65a6731ep-4, log2p1(@as(f128, 0x6.af53d00fd2845d4772260ef5adc4p-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba3b9eb65a67322p-4, log2p1(@as(f128, 0x6.af53d00fd2845d4772260ef5aep-4)));
    // try std.testing.expectEqual(0x8.0efc6087a73bba3b9eb65a67301p-4, log2p1(@as(f128, 0x6.af53d00fd2845d4772260ef5acp-4)));
}
