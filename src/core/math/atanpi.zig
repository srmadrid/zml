const std = @import("std");
const types = @import("../types.zig");
const math = @import("../math.zig");
const EnsureFloat = types.EnsureFloat;
const cast = types.cast;

pub inline fn atanpi(x: anytype) EnsureFloat(@TypeOf(x)) {
    comptime if (!types.isFixedPrecision(@TypeOf(x)) or types.isComplex(@TypeOf(x)))
        @compileError("x must be an int or float");

    switch (types.numericType(@TypeOf(x))) {
        .int => {
            return atanpi(cast(EnsureFloat(@TypeOf(x)), x, .{}));
        },
        .float => {
            const ret: @TypeOf(x) = math.atan(x) / std.math.pi;
            if (!std.math.isNan(x)) {
                @branchHint(.likely);

                if (math.abs(ret) < std.math.floatMin(@TypeOf(x))) {
                    const vret: @TypeOf(x) = ret * ret;
                    std.mem.doNotOptimizeAway(vret);
                }
            }

            // Ensure that rounding away from zero for both atan and the
            // division cannot yield a return value from atanpi with absolute
            // value greater than 0.5.
            return if (math.abs(ret) > 0.5) math.copysign(@as(@TypeOf(x), 0.5), ret) else ret;
        },
        else => unreachable,
    }
}

test atanpi {
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f32, -0x0p+0)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f32, 0xf.fffffp+124)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f32, -0xf.fffffp+124)));
    try std.testing.expectEqual(0x4p-4, atanpi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(-0x4p-4, atanpi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x3.46feb8p-4, atanpi(@as(f32, 0xcp-4)));
    // try std.testing.expectEqual(0x2.8bafc4p-8, atanpi(@as(f32, 0x8p-8)));
    try std.testing.expectEqual(0x1.45f3p-12, atanpi(@as(f32, 0x4p-12)));
    try std.testing.expectEqual(0xa.2f983p-20, atanpi(@as(f32, 0x2p-16)));
    try std.testing.expectEqual(0x5.17cc18p-24, atanpi(@as(f32, 0x1p-20)));
    try std.testing.expectEqual(0x2.8be60cp-28, atanpi(@as(f32, 0x8p-28)));
    try std.testing.expectEqual(0x1.45f306p-32, atanpi(@as(f32, 0x4p-32)));
    try std.testing.expectEqual(0xa.2f983p-40, atanpi(@as(f32, 0x2p-36)));
    try std.testing.expectEqual(0x5.17cc18p-44, atanpi(@as(f32, 0x1p-40)));
    try std.testing.expectEqual(0x2.8be60cp-48, atanpi(@as(f32, 0x8p-48)));
    try std.testing.expectEqual(0x1.45f306p-52, atanpi(@as(f32, 0x4p-52)));
    try std.testing.expectEqual(0xa.2f983p-60, atanpi(@as(f32, 0x2p-56)));
    try std.testing.expectEqual(0x5.17cc18p-64, atanpi(@as(f32, 0x1p-60)));
    try std.testing.expectEqual(0x6.0fe598p-4, atanpi(@as(f32, 0x2.8p+0)));
    // try std.testing.expectEqual(0x7.7e0d6p-4, atanpi(@as(f32, 0xap+0)));
    try std.testing.expectEqual(0x7.ffffa8p-4, atanpi(@as(f32, 0xf.424p+16)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f32, 0x8p+28)));
    try std.testing.expectEqual(0x5.17cc18p-104, atanpi(@as(f32, 0x1p-100)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(-0x1.2761a8p-4, atanpi(@as(f32, -0x3.b02d84p-4)));
    try std.testing.expectEqual(-0x1.053124p-4, atanpi(@as(f32, -0x3.3fb708p-4)));
    // try std.testing.expectEqual(-0x5.d2f7bp-4, atanpi(@as(f32, -0x2.3249ap+0)));
    try std.testing.expectEqual(-0x4.7c8678p-4, atanpi(@as(f32, -0x1.363f46p+0)));
    try std.testing.expectEqual(-0x5.42eecp-4, atanpi(@as(f32, -0x1.ad4c0ap+0)));
    // try std.testing.expectEqual(-0x6.ba5afp-4, atanpi(@as(f32, -0x3.eb8e18p+0)));
    try std.testing.expectEqual(0x6.8355cp-4, atanpi(@as(f32, 0x3.53c188p+0)));
    try std.testing.expectEqual(-0x4.bf499p-4, atanpi(@as(f32, -0x1.58c83p+0)));
    try std.testing.expectEqual(0x3.156898p-4, atanpi(@as(f32, 0xb.133b9p-4)));
    try std.testing.expectEqual(0x1.45f308p-128, atanpi(@as(f32, 0x4p-128)));
    try std.testing.expectEqual(-0x1.45f308p-128, atanpi(@as(f32, -0x4p-128)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f32, -0x8p-152)));
    try std.testing.expectEqual(0x3.2f0774p-4, atanpi(@as(f32, 0xb.8bf1dp-4)));
    try std.testing.expectEqual(0xf.f29d6p-8, atanpi(@as(f32, 0x3.2c0364p-4)));
    try std.testing.expectEqual(0xf.f29d5p-8, atanpi(@as(f32, 0x3.2c036p-4)));
    // try std.testing.expectEqual(0x3.ff5148p-8, atanpi(@as(f32, 0xc.916d9p-8)));
    // try std.testing.expectEqual(0x3.ff5144p-8, atanpi(@as(f32, 0xc.916d8p-8)));
    // try std.testing.expectEqual(0xf.f99f3p-8, atanpi(@as(f32, 0x3.2d7178p-4)));
    // try std.testing.expectEqual(0xf.f99f2p-8, atanpi(@as(f32, 0x3.2d7174p-4)));

    try std.testing.expectEqual(0x0p+0, atanpi(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f64, -0x0p+0)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f64, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f64, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f64, -0xf.fffffp+124)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f64, -0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x4p-4, atanpi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(-0x4p-4, atanpi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0x3.46feb898833dep-4, atanpi(@as(f64, 0xcp-4)));
    try std.testing.expectEqual(0x2.8bafc2b208c5p-8, atanpi(@as(f64, 0x8p-8)));
    try std.testing.expectEqual(0x1.45f30012374f7p-12, atanpi(@as(f64, 0x4p-12)));
    try std.testing.expectEqual(0xa.2f9836d74f768p-20, atanpi(@as(f64, 0x2p-16)));
    try std.testing.expectEqual(0x5.17cc1b72706ep-24, atanpi(@as(f64, 0x1p-20)));
    try std.testing.expectEqual(0x2.8be60db939102p-28, atanpi(@as(f64, 0x8p-28)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-32, atanpi(@as(f64, 0x4p-32)));
    try std.testing.expectEqual(0xa.2f9836e4e4418p-40, atanpi(@as(f64, 0x2p-36)));
    try std.testing.expectEqual(0x5.17cc1b727220cp-44, atanpi(@as(f64, 0x1p-40)));
    try std.testing.expectEqual(0x2.8be60db939106p-48, atanpi(@as(f64, 0x8p-48)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-52, atanpi(@as(f64, 0x4p-52)));
    try std.testing.expectEqual(0xa.2f9836e4e4418p-60, atanpi(@as(f64, 0x2p-56)));
    try std.testing.expectEqual(0x5.17cc1b727220cp-64, atanpi(@as(f64, 0x1p-60)));
    try std.testing.expectEqual(0x6.0fe595af0f20cp-4, atanpi(@as(f64, 0x2.8p+0)));
    // try std.testing.expectEqual(0x7.7e0d6242fe56cp-4, atanpi(@as(f64, 0xap+0)));
    try std.testing.expectEqual(0x7.ffffaa8de9434p-4, atanpi(@as(f64, 0xf.424p+16)));
    try std.testing.expectEqual(0x7.fffffff5d067cp-4, atanpi(@as(f64, 0x8p+28)));
    try std.testing.expectEqual(0x5.17cc1b727220cp-104, atanpi(@as(f64, 0x1p-100)));
    try std.testing.expectEqual(0x2.8be60db939106p-152, atanpi(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(0x5.17cc1b727220cp-604, atanpi(@as(f64, 0x1p-600)));
    try std.testing.expectEqual(0x2.8be60db939106p-152, atanpi(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f64, 0x4p-1076)));
    try std.testing.expectEqual(-0x1.2761a8c2bbb8dp-4, atanpi(@as(f64, -0x3.b02d84p-4)));
    try std.testing.expectEqual(-0x1.0531241695696p-4, atanpi(@as(f64, -0x3.3fb708p-4)));
    // try std.testing.expectEqual(-0x5.d2f7ac19ac6e8p-4, atanpi(@as(f64, -0x2.3249ap+0)));
    try std.testing.expectEqual(-0x4.7c867ba081c38p-4, atanpi(@as(f64, -0x1.363f46p+0)));
    // try std.testing.expectEqual(-0x5.42eebe541dff8p-4, atanpi(@as(f64, -0x1.ad4c0ap+0)));
    try std.testing.expectEqual(-0x6.ba5aef41e9fb4p-4, atanpi(@as(f64, -0x3.eb8e18p+0)));
    // try std.testing.expectEqual(0x6.8355c1a796978p-4, atanpi(@as(f64, 0x3.53c188p+0)));
    try std.testing.expectEqual(-0x4.bf498c943b93p-4, atanpi(@as(f64, -0x1.58c83p+0)));
    // try std.testing.expectEqual(0x3.156898f544dcap-4, atanpi(@as(f64, 0xb.133b9p-4)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-128, atanpi(@as(f64, 0x4p-128)));
    try std.testing.expectEqual(0x1.45f306dc9c884p-1024, atanpi(@as(f64, 0x4p-1024)));
    try std.testing.expectEqual(0x2.8be60db939106p-972, atanpi(@as(f64, 0x8p-972)));
    try std.testing.expectEqual(-0x1.45f306dc9c883p-128, atanpi(@as(f64, -0x4p-128)));
    try std.testing.expectEqual(-0x1.45f306dc9c884p-1024, atanpi(@as(f64, -0x4p-1024)));
    try std.testing.expectEqual(-0x2.8be60db939106p-972, atanpi(@as(f64, -0x8p-972)));
    try std.testing.expectEqual(0x2.8be60db939106p-152, atanpi(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f64, 0x4p-1076)));
    try std.testing.expectEqual(-0x2.8be60db939106p-152, atanpi(@as(f64, -0x8p-152)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f64, -0x4p-1076)));
    try std.testing.expectEqual(0x3.2f0773b0c466ap-4, atanpi(@as(f64, 0xb.8bf1dp-4)));
    // try std.testing.expectEqual(0xf.f29d64e613d08p-8, atanpi(@as(f64, 0x3.2c0364p-4)));
    // try std.testing.expectEqual(0xf.f29d514c19d78p-8, atanpi(@as(f64, 0x3.2c036p-4)));
    // try std.testing.expectEqual(0xf.f29d5496e2fap-8, atanpi(@as(f64, 0x3.2c0360abfbf2ep-4)));
    try std.testing.expectEqual(0x3.ff5148ef6ca1ap-8, atanpi(@as(f64, 0xc.916d9p-8)));
    // try std.testing.expectEqual(0x3.ff5143dac30e4p-8, atanpi(@as(f64, 0xc.916d8p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a7ap-8, atanpi(@as(f64, 0xc.916d8196a7d2p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a78p-8, atanpi(@as(f64, 0xc.916d8196a7d18p-8)));
    // try std.testing.expectEqual(0xf.f99f312711588p-8, atanpi(@as(f64, 0x3.2d7178p-4)));
    try std.testing.expectEqual(0xf.f99f1d8dc298p-8, atanpi(@as(f64, 0x3.2d7174p-4)));
    try std.testing.expectEqual(0xf.f99f30ea14148p-8, atanpi(@as(f64, 0x3.2d7177f38d6fp-4)));
    // try std.testing.expectEqual(0xf.f99f30ea14138p-8, atanpi(@as(f64, 0x3.2d7177f38d6eep-4)));

    try std.testing.expectEqual(0x0p+0, atanpi(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f80, -0x0p+0)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f80, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f80, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f80, 0xf.fffffffffffffffp+16380)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f80, -0xf.fffffp+124)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f80, -0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f80, -0xf.fffffffffffffffp+16380)));
    try std.testing.expectEqual(0x4p-4, atanpi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(-0x4p-4, atanpi(@as(f80, -0x1p+0)));
    // try std.testing.expectEqual(0x3.46feb898833de66cp-4, atanpi(@as(f80, 0xcp-4)));
    try std.testing.expectEqual(0x2.8bafc2b208c4f0acp-8, atanpi(@as(f80, 0x8p-8)));
    try std.testing.expectEqual(0x1.45f30012374f6cfep-12, atanpi(@as(f80, 0x4p-12)));
    try std.testing.expectEqual(0xa.2f9836d74f765eep-20, atanpi(@as(f80, 0x2p-16)));
    try std.testing.expectEqual(0x5.17cc1b72706e0ffp-24, atanpi(@as(f80, 0x1p-20)));
    try std.testing.expectEqual(0x2.8be60db939101e54p-28, atanpi(@as(f80, 0x8p-28)));
    try std.testing.expectEqual(0x1.45f306dc9c882a4ep-32, atanpi(@as(f80, 0x4p-32)));
    try std.testing.expectEqual(0xa.2f9836e4e44152ap-40, atanpi(@as(f80, 0x2p-36)));
    try std.testing.expectEqual(0x5.17cc1b727220a95p-44, atanpi(@as(f80, 0x1p-40)));
    try std.testing.expectEqual(0x2.8be60db9391054a8p-48, atanpi(@as(f80, 0x8p-48)));
    try std.testing.expectEqual(0x1.45f306dc9c882a54p-52, atanpi(@as(f80, 0x4p-52)));
    try std.testing.expectEqual(0xa.2f9836e4e44152ap-60, atanpi(@as(f80, 0x2p-56)));
    try std.testing.expectEqual(0x5.17cc1b727220a95p-64, atanpi(@as(f80, 0x1p-60)));
    try std.testing.expectEqual(0x6.0fe595af0f20ccbp-4, atanpi(@as(f80, 0x2.8p+0)));
    // try std.testing.expectEqual(0x7.7e0d6242fe56c4c8p-4, atanpi(@as(f80, 0xap+0)));
    try std.testing.expectEqual(0x7.ffffaa8de94331ep-4, atanpi(@as(f80, 0xf.424p+16)));
    try std.testing.expectEqual(0x7.fffffff5d067c918p-4, atanpi(@as(f80, 0x8p+28)));
    try std.testing.expectEqual(0x5.17cc1b727220a95p-104, atanpi(@as(f80, 0x1p-100)));
    try std.testing.expectEqual(0x2.8be60db9391054a8p-152, atanpi(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(0x5.17cc1b727220a95p-604, atanpi(@as(f80, 0x1p-600)));
    try std.testing.expectEqual(0x2.8be60db9391054a8p-152, atanpi(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(0x1.45f306dc9c882a54p-1076, atanpi(@as(f80, 0x4p-1076)));
    try std.testing.expectEqual(0x5.17cc1b727220a95p-10004, atanpi(@as(f80, 0x1p-10000)));
    try std.testing.expectEqual(-0x1.2761a8c2bbb8cce4p-4, atanpi(@as(f80, -0x3.b02d84p-4)));
    // try std.testing.expectEqual(-0x1.053124169569617p-4, atanpi(@as(f80, -0x3.3fb708p-4)));
    try std.testing.expectEqual(-0x5.d2f7ac19ac6e92e8p-4, atanpi(@as(f80, -0x2.3249ap+0)));
    try std.testing.expectEqual(-0x4.7c867ba081c38eep-4, atanpi(@as(f80, -0x1.363f46p+0)));
    // try std.testing.expectEqual(-0x5.42eebe541dff83fp-4, atanpi(@as(f80, -0x1.ad4c0ap+0)));
    // try std.testing.expectEqual(-0x6.ba5aef41e9fb3edp-4, atanpi(@as(f80, -0x3.eb8e18p+0)));
    try std.testing.expectEqual(0x6.8355c1a796977dp-4, atanpi(@as(f80, 0x3.53c188p+0)));
    try std.testing.expectEqual(-0x4.bf498c943b930b1p-4, atanpi(@as(f80, -0x1.58c83p+0)));
    try std.testing.expectEqual(0x3.156898f544dca53p-4, atanpi(@as(f80, 0xb.133b9p-4)));
    try std.testing.expectEqual(0x1.45f306dc9c882a54p-128, atanpi(@as(f80, 0x4p-128)));
    try std.testing.expectEqual(0x1.45f306dc9c882a54p-1024, atanpi(@as(f80, 0x4p-1024)));
    try std.testing.expectEqual(0x1.45f306dc9c882a5p-16384, atanpi(@as(f80, 0x4p-16384)));
    try std.testing.expectEqual(0xa.2f9836e4e441528p-16388, atanpi(@as(f80, 0x2p-16384)));
    try std.testing.expectEqual(0x2.8be60db9391054a8p-972, atanpi(@as(f80, 0x8p-972)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a54p-128, atanpi(@as(f80, -0x4p-128)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a54p-1024, atanpi(@as(f80, -0x4p-1024)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a5p-16384, atanpi(@as(f80, -0x4p-16384)));
    try std.testing.expectEqual(-0xa.2f9836e4e441528p-16388, atanpi(@as(f80, -0x2p-16384)));
    try std.testing.expectEqual(-0x2.8be60db9391054a8p-972, atanpi(@as(f80, -0x8p-972)));
    try std.testing.expectEqual(0x2.8be60db9391054a8p-152, atanpi(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x1.45f306dc9c882a54p-1076, atanpi(@as(f80, 0x4p-1076)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f80, 0x8p-16448)));
    try std.testing.expectEqual(-0x2.8be60db9391054a8p-152, atanpi(@as(f80, -0x8p-152)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a54p-1076, atanpi(@as(f80, -0x4p-1076)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f80, -0x8p-16448)));
    try std.testing.expectEqual(0x3.2f0773b0c4669f9p-4, atanpi(@as(f80, 0xb.8bf1dp-4)));
    // try std.testing.expectEqual(0xf.f29d64e613d0b71p-8, atanpi(@as(f80, 0x3.2c0364p-4)));
    try std.testing.expectEqual(0xf.f29d514c19d7903p-8, atanpi(@as(f80, 0x3.2c036p-4)));
    try std.testing.expectEqual(0xf.f29d5496e2fa3ffp-8, atanpi(@as(f80, 0x3.2c0360abfbf2ep-4)));
    try std.testing.expectEqual(0x3.ff5148ef6ca19194p-8, atanpi(@as(f80, 0xc.916d9p-8)));
    // try std.testing.expectEqual(0x3.ff5143dac30e4c6p-8, atanpi(@as(f80, 0xc.916d8p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a79edcp-8, atanpi(@as(f80, 0xc.916d8196a7d2p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a77634p-8, atanpi(@as(f80, 0xc.916d8196a7d18p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a7894p-8, atanpi(@as(f80, 0xc.916d8196a7d1bbfp-8)));
    try std.testing.expectEqual(0xf.f99f3127115843dp-8, atanpi(@as(f80, 0x3.2d7178p-4)));
    // try std.testing.expectEqual(0xf.f99f1d8dc297d66p-8, atanpi(@as(f80, 0x3.2d7174p-4)));
    // try std.testing.expectEqual(0xf.f99f30ea14144bap-8, atanpi(@as(f80, 0x3.2d7177f38d6fp-4)));
    try std.testing.expectEqual(0xf.f99f30ea1413aedp-8, atanpi(@as(f80, 0x3.2d7177f38d6eep-4)));
    try std.testing.expectEqual(0xf.f99f30ea1413b6p-8, atanpi(@as(f80, 0x3.2d7177f38d6ee178p-4)));
    try std.testing.expectEqual(0xf.f99f30ea1413b5fp-8, atanpi(@as(f80, 0x3.2d7177f38d6ee174p-4)));

    try std.testing.expectEqual(0x0p+0, atanpi(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f128, -0x0p+0)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f128, 0xf.fffffp+124)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f128, 0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f128, 0xf.fffffffffffffffp+16380)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f128, 0xf.fffffffffffffffffffffffffff8p+16380)));
    try std.testing.expectEqual(0x8p-4, atanpi(@as(f128, 0xf.ffffffffffffbffffffffffffcp+1020)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f128, -0xf.fffffp+124)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f128, -0xf.ffffffffffff8p+1020)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f128, -0xf.fffffffffffffffp+16380)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f128, -0xf.fffffffffffffffffffffffffff8p+16380)));
    try std.testing.expectEqual(-0x8p-4, atanpi(@as(f128, -0xf.ffffffffffffbffffffffffffcp+1020)));
    try std.testing.expectEqual(0x4p-4, atanpi(@as(f128, 0x1p+0)));
    try std.testing.expectEqual(-0x4p-4, atanpi(@as(f128, -0x1p+0)));
    try std.testing.expectEqual(0x3.46feb898833de66a5dc249472b9ap-4, atanpi(@as(f128, 0xcp-4)));
    // try std.testing.expectEqual(0x2.8bafc2b208c4f0ad3929bd05b5eep-8, atanpi(@as(f128, 0x8p-8)));
    try std.testing.expectEqual(0x1.45f30012374f6cfe8752442339p-12, atanpi(@as(f128, 0x4p-12)));
    try std.testing.expectEqual(0xa.2f9836d74f765ee47fc135b8922p-20, atanpi(@as(f128, 0x2p-16)));
    // try std.testing.expectEqual(0x5.17cc1b72706e0ff165c06319a594p-24, atanpi(@as(f128, 0x1p-20)));
    try std.testing.expectEqual(0x2.8be60db939101e54c4cdefdbd5ecp-28, atanpi(@as(f128, 0x8p-28)));
    try std.testing.expectEqual(0x1.45f306dc9c882a4d2de935b5fce9p-32, atanpi(@as(f128, 0x4p-32)));
    try std.testing.expectEqual(0xa.2f9836e4e441529fb4e0b22b777p-40, atanpi(@as(f128, 0x2p-36)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe1390bf64b2cp-44, atanpi(@as(f128, 0x1p-40)));
    try std.testing.expectEqual(0x2.8be60db9391054a7f09d5f1181a8p-48, atanpi(@as(f128, 0x8p-48)));
    try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3e39fp-52, atanpi(@as(f128, 0x4p-52)));
    try std.testing.expectEqual(0xa.2f9836e4e441529fc2757d1f534p-60, atanpi(@as(f128, 0x2p-56)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe13abe8fa9a8p-64, atanpi(@as(f128, 0x1p-60)));
    // try std.testing.expectEqual(0x6.0fe595af0f20ccaca63bfed1bcep-4, atanpi(@as(f128, 0x2.8p+0)));
    try std.testing.expectEqual(0x7.7e0d6242fe56c4c47814ff56015p-4, atanpi(@as(f128, 0xap+0)));
    try std.testing.expectEqual(0x7.ffffaa8de94331df46e41084e234p-4, atanpi(@as(f128, 0xf.424p+16)));
    // try std.testing.expectEqual(0x7.fffffff5d067c91b1bbead6dd254p-4, atanpi(@as(f128, 0x8p+28)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe13abe8fa9a8p-104, atanpi(@as(f128, 0x1p-100)));
    try std.testing.expectEqual(0x2.8be60db9391054a7f09d5f47d4d4p-152, atanpi(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe13abe8fa9a8p-604, atanpi(@as(f128, 0x1p-600)));
    try std.testing.expectEqual(0x2.8be60db9391054a7f09d5f47d4d4p-152, atanpi(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3ea6ap-1076, atanpi(@as(f128, 0x4p-1076)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe13abe8fa9a8p-10004, atanpi(@as(f128, 0x1p-10000)));
    try std.testing.expectEqual(-0x1.2761a8c2bbb8cce4d6ada4147145p-4, atanpi(@as(f128, -0x3.b02d84p-4)));
    try std.testing.expectEqual(-0x1.053124169569616f81a493c374c9p-4, atanpi(@as(f128, -0x3.3fb708p-4)));
    // try std.testing.expectEqual(-0x5.d2f7ac19ac6e92e956d6e6111ac4p-4, atanpi(@as(f128, -0x2.3249ap+0)));
    try std.testing.expectEqual(-0x4.7c867ba081c38ee03c4943059fb8p-4, atanpi(@as(f128, -0x1.363f46p+0)));
    // try std.testing.expectEqual(-0x5.42eebe541dff83f075ed4fb4b60cp-4, atanpi(@as(f128, -0x1.ad4c0ap+0)));
    // try std.testing.expectEqual(-0x6.ba5aef41e9fb3ece4eb52cc5672p-4, atanpi(@as(f128, -0x3.eb8e18p+0)));
    try std.testing.expectEqual(0x6.8355c1a796977d00f9aaa3299b78p-4, atanpi(@as(f128, 0x3.53c188p+0)));
    try std.testing.expectEqual(-0x4.bf498c943b930b1011b646f3b4cp-4, atanpi(@as(f128, -0x1.58c83p+0)));
    try std.testing.expectEqual(0x3.156898f544dca52f89f818e1277p-4, atanpi(@as(f128, 0xb.133b9p-4)));
    try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3ea6ap-128, atanpi(@as(f128, 0x4p-128)));
    try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3ea6ap-1024, atanpi(@as(f128, 0x4p-1024)));
    // try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3ea68p-16384, atanpi(@as(f128, 0x4p-16384)));
    // try std.testing.expectEqual(0xa.2f9836e4e441529fc2757d1f534p-16388, atanpi(@as(f128, 0x2p-16384)));
    try std.testing.expectEqual(0x2.8be60db9391054a7f09d5f47d4d4p-972, atanpi(@as(f128, 0x8p-972)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a53f84eafa3ea6ap-128, atanpi(@as(f128, -0x4p-128)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a53f84eafa3ea6ap-1024, atanpi(@as(f128, -0x4p-1024)));
    // try std.testing.expectEqual(-0x1.45f306dc9c882a53f84eafa3ea68p-16384, atanpi(@as(f128, -0x4p-16384)));
    // try std.testing.expectEqual(-0xa.2f9836e4e441529fc2757d1f534p-16388, atanpi(@as(f128, -0x2p-16384)));
    try std.testing.expectEqual(-0x2.8be60db9391054a7f09d5f47d4d4p-972, atanpi(@as(f128, -0x8p-972)));
    try std.testing.expectEqual(0x2.8be60db9391054a7f09d5f47d4d4p-152, atanpi(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x1.45f306dc9c882a53f84eafa3ea6ap-1076, atanpi(@as(f128, 0x4p-1076)));
    // try std.testing.expectEqual(0x2.8be60db9391p-16448, atanpi(@as(f128, 0x8p-16448)));
    // try std.testing.expectEqual(0x1.45f306dc9c88p-16448, atanpi(@as(f128, 0x4p-16448)));
    try std.testing.expectEqual(0x0p+0, atanpi(@as(f128, 0x4p-16496)));
    try std.testing.expectEqual(-0x2.8be60db9391054a7f09d5f47d4d4p-152, atanpi(@as(f128, -0x8p-152)));
    try std.testing.expectEqual(-0x1.45f306dc9c882a53f84eafa3ea6ap-1076, atanpi(@as(f128, -0x4p-1076)));
    // try std.testing.expectEqual(-0x2.8be60db9391p-16448, atanpi(@as(f128, -0x8p-16448)));
    // try std.testing.expectEqual(-0x1.45f306dc9c88p-16448, atanpi(@as(f128, -0x4p-16448)));
    try std.testing.expectEqual(-0x0p+0, atanpi(@as(f128, -0x4p-16496)));
    try std.testing.expectEqual(0x3.2f0773b0c4669f8fbf457d0b714ap-4, atanpi(@as(f128, 0xb.8bf1dp-4)));
    try std.testing.expectEqual(0xf.f29d64e613d0b7088b8d67e82b2p-8, atanpi(@as(f128, 0x3.2c0364p-4)));
    try std.testing.expectEqual(0xf.f29d514c19d79034968ccf048e08p-8, atanpi(@as(f128, 0x3.2c036p-4)));
    try std.testing.expectEqual(0xf.f29d5496e2fa3ff575a9d2537808p-8, atanpi(@as(f128, 0x3.2c0360abfbf2ep-4)));
    try std.testing.expectEqual(0x3.ff5148ef6ca19194e595428698c4p-8, atanpi(@as(f128, 0xc.916d9p-8)));
    // try std.testing.expectEqual(0x3.ff5143dac30e4c612590e4511712p-8, atanpi(@as(f128, 0xc.916d8p-8)));
    // try std.testing.expectEqual(0x3.ff51445be4a79edb1a9665d0947cp-8, atanpi(@as(f128, 0xc.916d8196a7d2p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a77635cdfc22abd924p-8, atanpi(@as(f128, 0xc.916d8196a7d18p-8)));
    try std.testing.expectEqual(0x3.ff51445be4a7893e353adedcac5ep-8, atanpi(@as(f128, 0xc.916d8196a7d1bbfp-8)));
    // try std.testing.expectEqual(0xf.f99f3127115843d69eaebfa73c4p-8, atanpi(@as(f128, 0x3.2d7178p-4)));
    // try std.testing.expectEqual(0xf.f99f1d8dc297d6589e241ccb3bc8p-8, atanpi(@as(f128, 0x3.2d7174p-4)));
    try std.testing.expectEqual(0xf.f99f30ea14144b9be7a0c1c0327p-8, atanpi(@as(f128, 0x3.2d7177f38d6fp-4)));
    try std.testing.expectEqual(0xf.f99f30ea1413aed171a4a468927p-8, atanpi(@as(f128, 0x3.2d7177f38d6eep-4)));
    // try std.testing.expectEqual(0xf.f99f30ea1413b603bc8ef6c15808p-8, atanpi(@as(f128, 0x3.2d7177f38d6ee178p-4)));
    try std.testing.expectEqual(0xf.f99f30ea1413b5f02340373dad18p-8, atanpi(@as(f128, 0x3.2d7177f38d6ee174p-4)));
    // try std.testing.expectEqual(0xf.f99f30ea1413b5f9496c03d5c108p-8, atanpi(@as(f128, 0x3.2d7177f38d6ee175de059ee6394p-4)));
    // try std.testing.expectEqual(0xf.f99f30ea1413b5f9496c03d5c4bp-8, atanpi(@as(f128, 0x3.2d7177f38d6ee175de059ee63ap-4)));
    // try std.testing.expectEqual(0xf.f99f30ea1413b5f9496c03d5bfc8p-8, atanpi(@as(f128, 0x3.2d7177f38d6ee175de059ee639p-4)));
}
