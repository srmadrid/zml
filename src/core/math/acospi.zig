const std = @import("std");
const types = @import("../types.zig");
const math = @import("../math.zig");
const EnsureFloat = types.EnsureFloat;
const cast = types.cast;

pub inline fn acospi(x: anytype) EnsureFloat(@TypeOf(x)) {
    comptime if (!types.isFixedPrecision(@TypeOf(x)) or types.isComplex(@TypeOf(x)))
        @compileError("x must be an int or float");

    switch (types.numericType(@TypeOf(x))) {
        .int => {
            return acospi(cast(EnsureFloat(@TypeOf(x)), x, .{}));
        },
        .float => {
            if (math.abs(x) > 1) {
                @branchHint(.unlikely);
                return (x - x) / (x - x);
            }

            const ret: @TypeOf(x) = math.acos(x) / std.math.pi;
            // Ensure that rounding upward for both acos and the division cannot
            // yield a return value from acospi greater than 1.
            return if (ret > 1) 1 else ret;
        },
        else => unreachable,
    }
}

test acospi {
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x0p+0)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x0p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x5.555558p-4, acospi(@as(f32, 0x8p-4)));
    try std.testing.expectEqual(0xa.aaaabp-4, acospi(@as(f32, -0x8p-4)));
    try std.testing.expectEqual(0x3.ae4c88p-4, acospi(@as(f32, 0xcp-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1.70ef56p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1.70ef54p-56)));
    try std.testing.expectEqual(0x7.ae75ap-4, acospi(@as(f32, 0x1p-4)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f32, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d908p-16, acospi(@as(f32, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8ccp-4, acospi(@as(f32, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f32, -0x1p+0)));
    // try std.testing.expectEqual(0x7.d73ffp-4, acospi(@as(f32, 0x8p-8)));
    try std.testing.expectEqual(0x7.feba1p-4, acospi(@as(f32, 0x4p-12)));
    try std.testing.expectEqual(0x7.fff5dp-4, acospi(@as(f32, 0x2p-16)));
    try std.testing.expectEqual(0x7.ffffbp-4, acospi(@as(f32, 0x1p-20)));
    // try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-28)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-32)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x2p-36)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1p-40)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-48)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-52)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x2p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1p-60)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-72)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x2p-76)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1p-80)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-92)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x2p-96)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1p-100)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-112)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x2p-116)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x1p-120)));
    try std.testing.expectEqual(0x8.28c01p-4, acospi(@as(f32, -0x8p-8)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-28)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-48)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-128)));
    // try std.testing.expectEqual(0x8.a3931p-4, acospi(@as(f32, -0x2.0089a4p-4)));
    // try std.testing.expectEqual(0x1.cb1826p-4, acospi(@as(f32, 0xf.04aeep-4)));
    try std.testing.expectEqual(0x6.16c52p-4, acospi(@as(f32, 0x5.dd2588p-4)));
    // try std.testing.expectEqual(0x6.16c528p-4, acospi(@as(f32, 0x5.dd258p-4)));
    try std.testing.expectEqual(0x8.b4b8dp-4, acospi(@as(f32, -0x2.35f05p-4)));
    // try std.testing.expectEqual(0x8.b4b8ep-4, acospi(@as(f32, -0x2.35f054p-4)));
    try std.testing.expectEqual(0x2.24e23p-4, acospi(@as(f32, 0xe.9a5c1p-4)));
    // try std.testing.expectEqual(0x2.24e24p-4, acospi(@as(f32, 0xe.9a5cp-4)));
    // try std.testing.expectEqual(0x2.8363c4p-4, acospi(@as(f32, 0xe.17514p-4)));
    try std.testing.expectEqual(0x2.8363ccp-4, acospi(@as(f32, 0xe.17513p-4)));
    try std.testing.expectEqual(0x6.bf4548p-4, acospi(@as(f32, 0x3.e57824p-4)));
    try std.testing.expectEqual(0x6.bf4548p-4, acospi(@as(f32, 0x3.e5782p-4)));
    try std.testing.expectEqual(0x7.58c4e8p-4, acospi(@as(f32, 0x2.0bee8p-4)));
    try std.testing.expectEqual(0x8.9738p-4, acospi(@as(f32, -0x1.da00d8p-4)));
    try std.testing.expectEqual(0x1.1a47c8p-12, acospi(@as(f32, 0xf.ffffap-4)));
    try std.testing.expectEqual(0x1.30e5cep-12, acospi(@as(f32, 0xf.ffff9p-4)));
    try std.testing.expectEqual(0x2.8bce48p-8, acospi(@as(f32, 0xf.fe003p-4)));
    try std.testing.expectEqual(0x2.8bd878p-8, acospi(@as(f32, 0xf.fe002p-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, 0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f32, -0x8p-152)));
    try std.testing.expectEqual(0xa.e1124p-4, acospi(@as(f32, -0x8.92316p-4)));
    try std.testing.expectEqual(0x1.f91882p-4, acospi(@as(f32, 0xe.d0754p-4)));
    try std.testing.expectEqual(0x1.f9189p-4, acospi(@as(f32, 0xe.d0753p-4)));
    // try std.testing.expectEqual(0x1.fc984cp-8, acospi(@as(f32, 0xf.fec86p-4)));
    try std.testing.expectEqual(0x1.fca55ap-8, acospi(@as(f32, 0xf.fec85p-4)));
    // try std.testing.expectEqual(0x3.ffd448p-4, acospi(@as(f32, 0xb.50b05p-4)));
    try std.testing.expectEqual(0x3.ffd45p-4, acospi(@as(f32, 0xb.50b04p-4)));

    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x0p+0)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x0p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    // try std.testing.expectEqual(0x5.5555555555554p-4, acospi(@as(f64, 0x8p-4)));
    // try std.testing.expectEqual(0xa.aaaaaaaaaaaa8p-4, acospi(@as(f64, -0x8p-4)));
    // try std.testing.expectEqual(0x3.ae4c8868cda3ap-4, acospi(@as(f64, 0xcp-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1.70ef56p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1.70ef54p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1.70ef54646d497p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1.70ef54646d496p-56)));
    // try std.testing.expectEqual(0x7.ae75a35db0b68p-4, acospi(@as(f64, 0x1p-4)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x5.17cc1b72a873cp-20, acospi(@as(f64, 0xf.fffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffae833e48d8p-4, acospi(@as(f64, -0xf.fffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x7.33d90a6f9989p-28, acospi(@as(f64, 0xf.fffffffffffp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffff8cc26f58p-4, acospi(@as(f64, -0xf.fffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-28, acospi(@as(f64, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9p-4, acospi(@as(f64, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-28, acospi(@as(f64, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9p-4, acospi(@as(f64, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-28, acospi(@as(f64, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9p-4, acospi(@as(f64, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f64, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f4p-16, acospi(@as(f64, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x1.45f306dc9c883p-28, acospi(@as(f64, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6cp-4, acospi(@as(f64, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f64, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9p-4, acospi(@as(f64, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x7.d73fec5a22378p-4, acospi(@as(f64, 0x8p-8)));
    // try std.testing.expectEqual(0x7.feba0cf5be30cp-4, acospi(@as(f64, 0x4p-12)));
    // try std.testing.expectEqual(0x7.fff5d067c9144p-4, acospi(@as(f64, 0x2p-16)));
    try std.testing.expectEqual(0x7.ffffae833e48cp-4, acospi(@as(f64, 0x1p-20)));
    try std.testing.expectEqual(0x7.fffffd7419f24p-4, acospi(@as(f64, 0x8p-28)));
    try std.testing.expectEqual(0x7.ffffffeba0cf8p-4, acospi(@as(f64, 0x4p-32)));
    try std.testing.expectEqual(0x7.ffffffff5d068p-4, acospi(@as(f64, 0x2p-36)));
    try std.testing.expectEqual(0x7.fffffffffae84p-4, acospi(@as(f64, 0x1p-40)));
    try std.testing.expectEqual(0x7.ffffffffffd74p-4, acospi(@as(f64, 0x8p-48)));
    try std.testing.expectEqual(0x7.fffffffffffecp-4, acospi(@as(f64, 0x4p-52)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x2p-56)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1p-60)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-72)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x2p-76)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1p-80)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-92)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x2p-96)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1p-100)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-112)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x2p-116)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x1p-120)));
    // try std.testing.expectEqual(0x8.28c013a5ddc88p-4, acospi(@as(f64, -0x8p-8)));
    try std.testing.expectEqual(0x8.0000028be60d8p-4, acospi(@as(f64, -0x8p-28)));
    try std.testing.expectEqual(0x8.0000000000288p-4, acospi(@as(f64, -0x8p-48)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-128)));
    try std.testing.expectEqual(0x8.a39317e863fep-4, acospi(@as(f64, -0x2.0089a4p-4)));
    try std.testing.expectEqual(0x1.cb1825930556bp-4, acospi(@as(f64, 0xf.04aeep-4)));
    // try std.testing.expectEqual(0x6.16c52323b4a04p-4, acospi(@as(f64, 0x5.dd2588p-4)));
    try std.testing.expectEqual(0x6.16c525e05aac4p-4, acospi(@as(f64, 0x5.dd258p-4)));
    // try std.testing.expectEqual(0x6.16c525de46fdcp-4, acospi(@as(f64, 0x5.dd258006121b8p-4)));
    try std.testing.expectEqual(0x8.b4b8d7f81fae8p-4, acospi(@as(f64, -0x2.35f05p-4)));
    try std.testing.expectEqual(0x8.b4b8d9413ac9p-4, acospi(@as(f64, -0x2.35f054p-4)));
    try std.testing.expectEqual(0x8.b4b8d894a8bc8p-4, acospi(@as(f64, -0x2.35f051e70dbc4p-4)));
    try std.testing.expectEqual(0x2.24e2318e8dfd8p-4, acospi(@as(f64, 0xe.9a5c1p-4)));
    try std.testing.expectEqual(0x2.24e23e04f3feep-4, acospi(@as(f64, 0xe.9a5cp-4)));
    try std.testing.expectEqual(0x2.24e233814f966p-4, acospi(@as(f64, 0xe.9a5c0d7fabbap-4)));
    try std.testing.expectEqual(0x2.24e233814f96cp-4, acospi(@as(f64, 0xe.9a5c0d7fabb98p-4)));
    try std.testing.expectEqual(0x2.8363c29cbd83p-4, acospi(@as(f64, 0xe.17514p-4)));
    try std.testing.expectEqual(0x2.8363cd5d2dc78p-4, acospi(@as(f64, 0xe.17513p-4)));
    try std.testing.expectEqual(0x2.8363c9a465758p-4, acospi(@as(f64, 0xe.17513589de7ap-4)));
    try std.testing.expectEqual(0x2.8363c9a46575ep-4, acospi(@as(f64, 0xe.17513589de798p-4)));
    // try std.testing.expectEqual(0x6.bf4549a06075p-4, acospi(@as(f64, 0x3.e57824p-4)));
    try std.testing.expectEqual(0x6.bf454af0717ep-4, acospi(@as(f64, 0x3.e5782p-4)));
    // try std.testing.expectEqual(0x6.bf454a570b4ap-4, acospi(@as(f64, 0x3.e57821d368ebap-4)));
    // try std.testing.expectEqual(0x7.58c4eb58917d8p-4, acospi(@as(f64, 0x2.0bee8p-4)));
    // try std.testing.expectEqual(0x8.9737ff89716bp-4, acospi(@as(f64, -0x1.da00d8p-4)));
    try std.testing.expectEqual(0x1.1a47c87b7e35fp-12, acospi(@as(f64, 0xf.ffffap-4)));
    try std.testing.expectEqual(0x1.30e5ce9f432edp-12, acospi(@as(f64, 0xf.ffff9p-4)));
    try std.testing.expectEqual(0x1.216401a341708p-12, acospi(@as(f64, 0xf.ffff9b1a566bp-4)));
    // try std.testing.expectEqual(0x2.8bce47db17496p-8, acospi(@as(f64, 0xf.fe003p-4)));
    try std.testing.expectEqual(0x2.8bd8782aad918p-8, acospi(@as(f64, 0xf.fe002p-4)));
    // try std.testing.expectEqual(0x2.8bd3f0621164ap-8, acospi(@as(f64, 0xf.fe00271d507fp-4)));
    // try std.testing.expectEqual(0x2.8bd3f06211b62p-8, acospi(@as(f64, 0xf.fe00271d507e8p-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, 0x4p-1076)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f64, -0x4p-1076)));
    try std.testing.expectEqual(0xa.e1123f028705p-4, acospi(@as(f64, -0x8.92316p-4)));
    try std.testing.expectEqual(0x1.f91882bd22e4p-4, acospi(@as(f64, 0xe.d0754p-4)));
    // try std.testing.expectEqual(0x1.f91890384a9f3p-4, acospi(@as(f64, 0xe.d0753p-4)));
    // try std.testing.expectEqual(0x1.f9188f034d814p-4, acospi(@as(f64, 0xe.d075316eb9188p-4)));
    try std.testing.expectEqual(0x1.fc984b610b0dep-8, acospi(@as(f64, 0xf.fec86p-4)));
    try std.testing.expectEqual(0x1.fca559dd144fp-8, acospi(@as(f64, 0xf.fec85p-4)));
    // try std.testing.expectEqual(0x1.fca0188d18d9p-8, acospi(@as(f64, 0xf.fec85670a4b08p-4)));
    try std.testing.expectEqual(0x1.fca0188d19417p-8, acospi(@as(f64, 0xf.fec85670a4bp-4)));
    try std.testing.expectEqual(0x3.ffd447ff33834p-4, acospi(@as(f64, 0xb.50b05p-4)));
    // try std.testing.expectEqual(0x3.ffd44f334a5f8p-4, acospi(@as(f64, 0xb.50b04p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbdde8p-4, acospi(@as(f64, 0xb.50b04f0a79178p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbddecp-4, acospi(@as(f64, 0xb.50b04f0a7917p-4)));

    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x0p+0)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x0p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    // try std.testing.expectEqual(0x5.5555555555555558p-4, acospi(@as(f80, 0x8p-4)));
    // try std.testing.expectEqual(0xa.aaaaaaaaaaaaaabp-4, acospi(@as(f80, -0x8p-4)));
    try std.testing.expectEqual(0x3.ae4c8868cda3a324p-4, acospi(@as(f80, 0xcp-4)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef56p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef54p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef54646d497p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef54646d496p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef54646d496894p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a8p-4, acospi(@as(f80, 0x1.70ef54646d496892p-56)));
    try std.testing.expectEqual(0x7.ae75a35db0b67ffp-4, acospi(@as(f80, 0x1p-4)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x5.17cc1b72a873d52p-20, acospi(@as(f80, 0xf.fffffff8p-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    // try std.testing.expectEqual(0xf.fffae833e48d579p-4, acospi(@as(f80, -0xf.fffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x7.33d90a6f9988e198p-28, acospi(@as(f80, 0xf.fffffffffffp-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffff8cc26f5906p-4, acospi(@as(f80, -0xf.fffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2ep-28, acospi(@as(f80, 0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9236p-4, acospi(@as(f80, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2ep-28, acospi(@as(f80, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0x7.33d90a6f998847f8p-36, acospi(@as(f80, 0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9236p-4, acospi(@as(f80, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0xf.fffffff8cc26f59p-4, acospi(@as(f80, -0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2ep-28, acospi(@as(f80, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0x7.33d90a6f998847f8p-36, acospi(@as(f80, 0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9236p-4, acospi(@as(f80, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0xf.fffffff8cc26f59p-4, acospi(@as(f80, -0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f80, 0x1p+0)));
    try std.testing.expectEqual(0x7.33d90b0940f3f3dp-16, acospi(@as(f80, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2ep-28, acospi(@as(f80, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0x7.33d90a6f998847f8p-36, acospi(@as(f80, 0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0xf.ff8cc26f4f6bf0cp-4, acospi(@as(f80, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f80, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffffeba0cf9236p-4, acospi(@as(f80, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0xf.fffffff8cc26f59p-4, acospi(@as(f80, -0xf.fffffffffffffffp-4)));
    // try std.testing.expectEqual(0x7.d73fec5a22377638p-4, acospi(@as(f80, 0x8p-8)));
    // try std.testing.expectEqual(0x7.feba0cf5be30a27p-4, acospi(@as(f80, 0x4p-12)));
    try std.testing.expectEqual(0x7.fff5d067c9145158p-4, acospi(@as(f80, 0x2p-16)));
    // try std.testing.expectEqual(0x7.ffffae833e48d8dp-4, acospi(@as(f80, 0x1p-20)));
    try std.testing.expectEqual(0x7.fffffd7419f246c8p-4, acospi(@as(f80, 0x8p-28)));
    try std.testing.expectEqual(0x7.ffffffeba0cf9238p-4, acospi(@as(f80, 0x4p-32)));
    try std.testing.expectEqual(0x7.ffffffff5d067c9p-4, acospi(@as(f80, 0x2p-36)));
    try std.testing.expectEqual(0x7.fffffffffae833e8p-4, acospi(@as(f80, 0x1p-40)));
    try std.testing.expectEqual(0x7.ffffffffffd741ap-4, acospi(@as(f80, 0x8p-48)));
    try std.testing.expectEqual(0x7.fffffffffffeba1p-4, acospi(@as(f80, 0x4p-52)));
    try std.testing.expectEqual(0x7.fffffffffffff5dp-4, acospi(@as(f80, 0x2p-56)));
    try std.testing.expectEqual(0x7.ffffffffffffffbp-4, acospi(@as(f80, 0x1p-60)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-72)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x2p-76)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x1p-80)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-92)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x2p-96)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x1p-100)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-112)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x2p-116)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x1p-120)));
    try std.testing.expectEqual(0x8.28c013a5ddc889cp-4, acospi(@as(f80, -0x8p-8)));
    try std.testing.expectEqual(0x8.0000028be60db94p-4, acospi(@as(f80, -0x8p-28)));
    try std.testing.expectEqual(0x8.000000000028be6p-4, acospi(@as(f80, -0x8p-48)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-68)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-88)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-128)));
    try std.testing.expectEqual(0x8.a39317e863fe18dp-4, acospi(@as(f80, -0x2.0089a4p-4)));
    try std.testing.expectEqual(0x1.cb1825930556a89cp-4, acospi(@as(f80, 0xf.04aeep-4)));
    try std.testing.expectEqual(0x6.16c52323b4a050d8p-4, acospi(@as(f80, 0x5.dd2588p-4)));
    try std.testing.expectEqual(0x6.16c525e05aac3fe8p-4, acospi(@as(f80, 0x5.dd258p-4)));
    try std.testing.expectEqual(0x6.16c525de46fdd91p-4, acospi(@as(f80, 0x5.dd258006121b8p-4)));
    try std.testing.expectEqual(0x8.b4b8d7f81fae72bp-4, acospi(@as(f80, -0x2.35f05p-4)));
    try std.testing.expectEqual(0x8.b4b8d9413ac8cf1p-4, acospi(@as(f80, -0x2.35f054p-4)));
    try std.testing.expectEqual(0x8.b4b8d894a8bc535p-4, acospi(@as(f80, -0x2.35f051e70dbc4p-4)));
    try std.testing.expectEqual(0x2.24e2318e8dfd8214p-4, acospi(@as(f80, 0xe.9a5c1p-4)));
    try std.testing.expectEqual(0x2.24e23e04f3fed138p-4, acospi(@as(f80, 0xe.9a5cp-4)));
    // try std.testing.expectEqual(0x2.24e233814f9651c4p-4, acospi(@as(f80, 0xe.9a5c0d7fabbap-4)));
    try std.testing.expectEqual(0x2.24e233814f96b574p-4, acospi(@as(f80, 0xe.9a5c0d7fabb98p-4)));
    // try std.testing.expectEqual(0x2.24e233814f9694b4p-4, acospi(@as(f80, 0xe.9a5c0d7fabb9aa1p-4)));
    try std.testing.expectEqual(0x2.8363c29cbd82fa74p-4, acospi(@as(f80, 0xe.17514p-4)));
    try std.testing.expectEqual(0x2.8363cd5d2dc77e7cp-4, acospi(@as(f80, 0xe.17513p-4)));
    try std.testing.expectEqual(0x2.8363c9a465758014p-4, acospi(@as(f80, 0xe.17513589de7ap-4)));
    try std.testing.expectEqual(0x2.8363c9a46575d618p-4, acospi(@as(f80, 0xe.17513589de798p-4)));
    try std.testing.expectEqual(0x2.8363c9a46575b0ecp-4, acospi(@as(f80, 0xe.17513589de79b75p-4)));
    try std.testing.expectEqual(0x6.bf4549a06074e3bp-4, acospi(@as(f80, 0x3.e57824p-4)));
    try std.testing.expectEqual(0x6.bf454af0717e121p-4, acospi(@as(f80, 0x3.e5782p-4)));
    try std.testing.expectEqual(0x6.bf454a570b4a158p-4, acospi(@as(f80, 0x3.e57821d368ebap-4)));
    try std.testing.expectEqual(0x7.58c4eb58917d6dp-4, acospi(@as(f80, 0x2.0bee8p-4)));
    // try std.testing.expectEqual(0x8.9737ff89716b1c5p-4, acospi(@as(f80, -0x1.da00d8p-4)));
    try std.testing.expectEqual(0x1.1a47c87b7e35f05ap-12, acospi(@as(f80, 0xf.ffffap-4)));
    try std.testing.expectEqual(0x1.30e5ce9f432ed128p-12, acospi(@as(f80, 0xf.ffff9p-4)));
    try std.testing.expectEqual(0x1.216401a34170832ep-12, acospi(@as(f80, 0xf.ffff9b1a566bp-4)));
    try std.testing.expectEqual(0x2.8bce47db17496418p-8, acospi(@as(f80, 0xf.fe003p-4)));
    try std.testing.expectEqual(0x2.8bd8782aad9178p-8, acospi(@as(f80, 0xf.fe002p-4)));
    try std.testing.expectEqual(0x2.8bd3f0621164a564p-8, acospi(@as(f80, 0xf.fe00271d507fp-4)));
    try std.testing.expectEqual(0x2.8bd3f06211b627dp-8, acospi(@as(f80, 0xf.fe00271d507e8p-4)));
    try std.testing.expectEqual(0x2.8bd3f06211755274p-8, acospi(@as(f80, 0xf.fe00271d507ee5dp-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x2p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x4p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x2p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x4p-1076)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, 0x8p-16448)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x4p-1076)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f80, -0x8p-16448)));
    // try std.testing.expectEqual(0xa.e1123f028704e9p-4, acospi(@as(f80, -0x8.92316p-4)));
    try std.testing.expectEqual(0x1.f91882bd22e3fb5cp-4, acospi(@as(f80, 0xe.d0754p-4)));
    // try std.testing.expectEqual(0x1.f91890384a9f31d2p-4, acospi(@as(f80, 0xe.d0753p-4)));
    // try std.testing.expectEqual(0x1.f9188f034d8147e2p-4, acospi(@as(f80, 0xe.d075316eb9188p-4)));
    try std.testing.expectEqual(0x1.fc984b610b0de578p-8, acospi(@as(f80, 0xf.fec86p-4)));
    try std.testing.expectEqual(0x1.fca559dd144efeacp-8, acospi(@as(f80, 0xf.fec85p-4)));
    try std.testing.expectEqual(0x1.fca0188d18d900b2p-8, acospi(@as(f80, 0xf.fec85670a4b08p-4)));
    // try std.testing.expectEqual(0x1.fca0188d1941745p-8, acospi(@as(f80, 0xf.fec85670a4bp-4)));
    try std.testing.expectEqual(0x1.fca0188d18e11cacp-8, acospi(@as(f80, 0xf.fec85670a4b0761p-4)));
    try std.testing.expectEqual(0x3.ffd447ff3383336cp-4, acospi(@as(f80, 0xb.50b05p-4)));
    try std.testing.expectEqual(0x3.ffd44f334a5f88b8p-4, acospi(@as(f80, 0xb.50b04p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbdde7728p-4, acospi(@as(f80, 0xb.50b04f0a79178p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbddeb0c8p-4, acospi(@as(f80, 0xb.50b04f0a7917p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbdde99bcp-4, acospi(@as(f80, 0xb.50b04f0a7917333p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbdde99c4p-4, acospi(@as(f80, 0xb.50b04f0a7917332p-4)));

    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x0p+0)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x0p+0)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    // try std.testing.expectEqual(0x5.5555555555555555555555555554p-4, acospi(@as(f128, 0x8p-4)));
    // try std.testing.expectEqual(0xa.aaaaaaaaaaaaaaaaaaaaaaaaaaa8p-4, acospi(@as(f128, -0x8p-4)));
    try std.testing.expectEqual(0x3.ae4c8868cda3a32545bb41cefd44p-4, acospi(@as(f128, 0xcp-4)));
    try std.testing.expectEqual(0x7.fffffffffffff8a907aaff4ae00cp-4, acospi(@as(f128, 0x1.70ef56p-56)));
    try std.testing.expectEqual(0x7.fffffffffffff8a907b52ee316f4p-4, acospi(@as(f128, 0x1.70ef54p-56)));
    try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac45p-4, acospi(@as(f128, 0x1.70ef54646d497p-56)));
    try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac4ap-4, acospi(@as(f128, 0x1.70ef54646d496p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496894p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496892p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496892137dfd73f5aap-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496892137dfd73f5a9p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496892137dfd73f6p-56)));
    // try std.testing.expectEqual(0x7.fffffffffffff8a907b32f6ac474p-4, acospi(@as(f128, 0x1.70ef54646d496892137dfd73f58p-56)));
    // try std.testing.expectEqual(0x7.ae75a35db0b67fefd406aae1fc8cp-4, acospi(@as(f128, 0x1p-4)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x5.17cc1b72a873d51f56c35424ff6cp-20, acospi(@as(f128, 0xf.fffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffae833e48d578c2ae0a93cabd8p-4, acospi(@as(f128, -0xf.fffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    try std.testing.expectEqual(0x7.33d90a6f9988e19af0f057b8e4cp-28, acospi(@as(f128, 0xf.fffffffffffp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    try std.testing.expectEqual(0xf.fffff8cc26f59066771e650f0fa8p-4, acospi(@as(f128, -0xf.fffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2d44fded619a87p-28, acospi(@as(f128, 0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    // try std.testing.expectEqual(0xf.fffffeba0cf9236377d4d2bb021p-4, acospi(@as(f128, -0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2d44fded619a87p-28, acospi(@as(f128, 0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x7.33d90a6f998847f41f0e7676b3a8p-36, acospi(@as(f128, 0xf.fffffffffffffffp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    // try std.testing.expectEqual(0xf.fffffeba0cf9236377d4d2bb021p-4, acospi(@as(f128, -0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.fffffff8cc26f5906677b80be0fp-4, acospi(@as(f128, -0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2d44fded619a87p-28, acospi(@as(f128, 0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x7.33d90a6f998847f41f0e7676b3a8p-36, acospi(@as(f128, 0xf.fffffffffffffffp-4)));
    // try std.testing.expectEqual(0x3.99ec8537ccc423f9c2b38576b38p-56, acospi(@as(f128, 0xf.fffffffffffffffffffffffffcp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    // try std.testing.expectEqual(0xf.fffffeba0cf9236377d4d2bb021p-4, acospi(@as(f128, -0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.fffffff8cc26f5906677b80be0fp-4, acospi(@as(f128, -0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0xf.ffffffffffffc66137ac8333bdcp-4, acospi(@as(f128, -0xf.fffffffffffffffffffffffffcp-4)));
    try std.testing.expectEqual(0x0p+0, acospi(@as(f128, 0x1p+0)));
    // try std.testing.expectEqual(0x7.33d90b0940f3f3d2c8fec0f7c64p-16, acospi(@as(f128, 0xf.fffffp-4)));
    // try std.testing.expectEqual(0x1.45f306dc9c882b2d44fded619a87p-28, acospi(@as(f128, 0xf.ffffffffffff8p-4)));
    try std.testing.expectEqual(0x7.33d90a6f998847f41f0e7676b3a8p-36, acospi(@as(f128, 0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0x5.17cc1b727220a94fe13abe8fa9a8p-60, acospi(@as(f128, 0xf.fffffffffffffffffffffffffff8p-4)));
    // try std.testing.expectEqual(0x3.99ec8537ccc423f9c2b38576b38p-56, acospi(@as(f128, 0xf.fffffffffffffffffffffffffcp-4)));
    // try std.testing.expectEqual(0xf.ff8cc26f4f6bf0c0c2d37013f08p-4, acospi(@as(f128, -0xf.fffffp-4)));
    try std.testing.expectEqual(0x1p+0, acospi(@as(f128, -0x1p+0)));
    // try std.testing.expectEqual(0xf.fffffeba0cf9236377d4d2bb021p-4, acospi(@as(f128, -0xf.ffffffffffff8p-4)));
    // try std.testing.expectEqual(0xf.fffffff8cc26f5906677b80be0fp-4, acospi(@as(f128, -0xf.fffffffffffffffp-4)));
    try std.testing.expectEqual(0xf.fffffffffffffae833e48d8ddf58p-4, acospi(@as(f128, -0xf.fffffffffffffffffffffffffff8p-4)));
    try std.testing.expectEqual(0xf.ffffffffffffc66137ac8333bdcp-4, acospi(@as(f128, -0xf.fffffffffffffffffffffffffcp-4)));
    // try std.testing.expectEqual(0x7.d73fec5a22377638e014ad43cfc8p-4, acospi(@as(f128, 0x8p-8)));
    // try std.testing.expectEqual(0x7.feba0cf5be30a26c7a4115b2da0cp-4, acospi(@as(f128, 0x4p-12)));
    try std.testing.expectEqual(0x7.fff5d067c9145159336616ec9258p-4, acospi(@as(f128, 0x2p-16)));
    try std.testing.expectEqual(0x7.ffffae833e48d8d060a00e1072f8p-4, acospi(@as(f128, 0x1p-20)));
    // try std.testing.expectEqual(0x7.fffffd7419f246c6ef902e797ae8p-4, acospi(@as(f128, 0x8p-28)));
    // try std.testing.expectEqual(0x7.ffffffeba0cf9236377d5a8a27e8p-4, acospi(@as(f128, 0x4p-32)));
    try std.testing.expectEqual(0x7.ffffffff5d067c91b1bbead6036cp-4, acospi(@as(f128, 0x2p-36)));
    try std.testing.expectEqual(0x7.fffffffffae833e48d8ddf56b02p-4, acospi(@as(f128, 0x1p-40)));
    try std.testing.expectEqual(0x7.ffffffffffd7419f246c6efab58p-4, acospi(@as(f128, 0x8p-48)));
    try std.testing.expectEqual(0x7.fffffffffffeba0cf9236377d5acp-4, acospi(@as(f128, 0x4p-52)));
    try std.testing.expectEqual(0x7.fffffffffffff5d067c91b1bbeacp-4, acospi(@as(f128, 0x2p-56)));
    try std.testing.expectEqual(0x7.ffffffffffffffae833e48d8ddf4p-4, acospi(@as(f128, 0x1p-60)));
    try std.testing.expectEqual(0x7.fffffffffffffffd7419f246c6fp-4, acospi(@as(f128, 0x8p-68)));
    try std.testing.expectEqual(0x7.ffffffffffffffffeba0cf923638p-4, acospi(@as(f128, 0x4p-72)));
    try std.testing.expectEqual(0x7.ffffffffffffffffff5d067c91bp-4, acospi(@as(f128, 0x2p-76)));
    try std.testing.expectEqual(0x7.fffffffffffffffffffae833e48cp-4, acospi(@as(f128, 0x1p-80)));
    try std.testing.expectEqual(0x7.ffffffffffffffffffffd7419f24p-4, acospi(@as(f128, 0x8p-88)));
    try std.testing.expectEqual(0x7.fffffffffffffffffffffeba0cf8p-4, acospi(@as(f128, 0x4p-92)));
    try std.testing.expectEqual(0x7.fffffffffffffffffffffff5d068p-4, acospi(@as(f128, 0x2p-96)));
    try std.testing.expectEqual(0x7.ffffffffffffffffffffffffae84p-4, acospi(@as(f128, 0x1p-100)));
    try std.testing.expectEqual(0x7.fffffffffffffffffffffffffd74p-4, acospi(@as(f128, 0x8p-108)));
    try std.testing.expectEqual(0x7.ffffffffffffffffffffffffffecp-4, acospi(@as(f128, 0x4p-112)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x2p-116)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x1p-120)));
    try std.testing.expectEqual(0x8.28c013a5ddc889c71feb52bc3038p-4, acospi(@as(f128, -0x8p-8)));
    try std.testing.expectEqual(0x8.0000028be60db939106fd1868518p-4, acospi(@as(f128, -0x8p-28)));
    try std.testing.expectEqual(0x8.000000000028be60db9391054a8p-4, acospi(@as(f128, -0x8p-48)));
    try std.testing.expectEqual(0x8.00000000000000028be60db9391p-4, acospi(@as(f128, -0x8p-68)));
    try std.testing.expectEqual(0x8.0000000000000000000028be60d8p-4, acospi(@as(f128, -0x8p-88)));
    try std.testing.expectEqual(0x8.0000000000000000000000000288p-4, acospi(@as(f128, -0x8p-108)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x8p-128)));
    try std.testing.expectEqual(0x8.a39317e863fe18cb2958f2370928p-4, acospi(@as(f128, -0x2.0089a4p-4)));
    try std.testing.expectEqual(0x1.cb1825930556a89c82084e62f75cp-4, acospi(@as(f128, 0xf.04aeep-4)));
    // try std.testing.expectEqual(0x6.16c52323b4a050d670754a62ce7p-4, acospi(@as(f128, 0x5.dd2588p-4)));
    try std.testing.expectEqual(0x6.16c525e05aac3fe4b9b9bc52d73cp-4, acospi(@as(f128, 0x5.dd258p-4)));
    try std.testing.expectEqual(0x6.16c525de46fdd913e7207c32d998p-4, acospi(@as(f128, 0x5.dd258006121b8p-4)));
    // try std.testing.expectEqual(0x8.b4b8d7f81fae72b66462776e4fa8p-4, acospi(@as(f128, -0x2.35f05p-4)));
    try std.testing.expectEqual(0x8.b4b8d9413ac8cf0e8ad14cbe528p-4, acospi(@as(f128, -0x2.35f054p-4)));
    try std.testing.expectEqual(0x8.b4b8d894a8bc53508b6fd28c49e8p-4, acospi(@as(f128, -0x2.35f051e70dbc4p-4)));
    // try std.testing.expectEqual(0x2.24e2318e8dfd8212fea7727d1464p-4, acospi(@as(f128, 0xe.9a5c1p-4)));
    try std.testing.expectEqual(0x2.24e23e04f3fed13784dd65735976p-4, acospi(@as(f128, 0xe.9a5cp-4)));
    try std.testing.expectEqual(0x2.24e233814f9651c2265c669d004cp-4, acospi(@as(f128, 0xe.9a5c0d7fabbap-4)));
    try std.testing.expectEqual(0x2.24e233814f96b57557222051cad6p-4, acospi(@as(f128, 0xe.9a5c0d7fabb98p-4)));
    try std.testing.expectEqual(0x2.24e233814f9694b214bb26ab43a8p-4, acospi(@as(f128, 0xe.9a5c0d7fabb9aa1p-4)));
    try std.testing.expectEqual(0x2.8363c29cbd82fa73921fe4ef534p-4, acospi(@as(f128, 0xe.17514p-4)));
    try std.testing.expectEqual(0x2.8363cd5d2dc77e7deab966266a0cp-4, acospi(@as(f128, 0xe.17513p-4)));
    // try std.testing.expectEqual(0x2.8363c9a46575801455de49bbb33ap-4, acospi(@as(f128, 0xe.17513589de7ap-4)));
    try std.testing.expectEqual(0x2.8363c9a46575d617d7ce7a259d8ep-4, acospi(@as(f128, 0xe.17513589de798p-4)));
    // try std.testing.expectEqual(0x2.8363c9a46575b0ec93c80f39d9f6p-4, acospi(@as(f128, 0xe.17513589de79b75p-4)));
    try std.testing.expectEqual(0x6.bf4549a06074e3ae247d89b115cp-4, acospi(@as(f128, 0x3.e57824p-4)));
    // try std.testing.expectEqual(0x6.bf454af0717e12137d20bda3e5cp-4, acospi(@as(f128, 0x3.e5782p-4)));
    try std.testing.expectEqual(0x6.bf454a570b4a158340cac04eb79p-4, acospi(@as(f128, 0x3.e57821d368ebap-4)));
    try std.testing.expectEqual(0x7.58c4eb58917d6d01cd5cfc8dd98cp-4, acospi(@as(f128, 0x2.0bee8p-4)));
    try std.testing.expectEqual(0x8.9737ff89716b1c4c1bbbec62f288p-4, acospi(@as(f128, -0x1.da00d8p-4)));
    // try std.testing.expectEqual(0x1.1a47c87b7e35f05953c540ca1238p-12, acospi(@as(f128, 0xf.ffffap-4)));
    try std.testing.expectEqual(0x1.30e5ce9f432ed128836d45c57f8dp-12, acospi(@as(f128, 0xf.ffff9p-4)));
    // try std.testing.expectEqual(0x1.216401a34170832dc786ef44ce7dp-12, acospi(@as(f128, 0xf.ffff9b1a566bp-4)));
    try std.testing.expectEqual(0x2.8bce47db17496416bb06c8e0322ap-8, acospi(@as(f128, 0xf.fe003p-4)));
    try std.testing.expectEqual(0x2.8bd8782aad9177ff28bf467c65dcp-8, acospi(@as(f128, 0xf.fe002p-4)));
    try std.testing.expectEqual(0x2.8bd3f0621164a565e0f62629a3a4p-8, acospi(@as(f128, 0xf.fe00271d507fp-4)));
    try std.testing.expectEqual(0x2.8bd3f06211b627d0870c9948171ep-8, acospi(@as(f128, 0xf.fe00271d507e8p-4)));
    try std.testing.expectEqual(0x2.8bd3f0621175527472b0fecb3be4p-8, acospi(@as(f128, 0xf.fe00271d507ee5dp-4)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x2p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-128)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-1024)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x2p-16384)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x8p-972)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-1076)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x8p-16448)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-16448)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, 0x4p-16496)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x8p-152)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-1076)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x8p-16448)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-16448)));
    try std.testing.expectEqual(0x8p-4, acospi(@as(f128, -0x4p-16496)));
    try std.testing.expectEqual(0xa.e1123f028704e8f85bb26d0d693p-4, acospi(@as(f128, -0x8.92316p-4)));
    try std.testing.expectEqual(0x1.f91882bd22e3fb5b8cd9724c270fp-4, acospi(@as(f128, 0xe.d0754p-4)));
    // try std.testing.expectEqual(0x1.f91890384a9f31d16e1daa546f9ep-4, acospi(@as(f128, 0xe.d0753p-4)));
    try std.testing.expectEqual(0x1.f9188f034d8147e1c240de1241cp-4, acospi(@as(f128, 0xe.d075316eb9188p-4)));
    try std.testing.expectEqual(0x1.fc984b610b0de578fd77039fd575p-8, acospi(@as(f128, 0xf.fec86p-4)));
    try std.testing.expectEqual(0x1.fca559dd144efeac2915bae403a6p-8, acospi(@as(f128, 0xf.fec85p-4)));
    // try std.testing.expectEqual(0x1.fca0188d18d900b1ddb6695561cep-8, acospi(@as(f128, 0xf.fec85670a4b08p-4)));
    try std.testing.expectEqual(0x1.fca0188d1941744f3c1682348257p-8, acospi(@as(f128, 0xf.fec85670a4bp-4)));
    try std.testing.expectEqual(0x1.fca0188d18e11cabb56a20084753p-8, acospi(@as(f128, 0xf.fec85670a4b0761p-4)));
    // try std.testing.expectEqual(0x3.ffd447ff3383336b319f9bac0112p-4, acospi(@as(f128, 0xb.50b05p-4)));
    // try std.testing.expectEqual(0x3.ffd44f334a5f88b8331417d20562p-4, acospi(@as(f128, 0xb.50b04p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbdde7728bd2a5b486a72p-4, acospi(@as(f128, 0xb.50b04f0a79178p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbddeb0c97430e66b47eap-4, acospi(@as(f128, 0xb.50b04f0a7917p-4)));
    try std.testing.expectEqual(0x3.ffd4486dbdde99bdceffa88736e6p-4, acospi(@as(f128, 0xb.50b04f0a7917333p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbdde99c5031689589b42p-4, acospi(@as(f128, 0xb.50b04f0a7917332p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbdde99c4bf021e6118aap-4, acospi(@as(f128, 0xb.50b04f0a7917332097372387f018p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbdde99c4bf021e6116e8p-4, acospi(@as(f128, 0xb.50b04f0a7917332097372387f4p-4)));
    // try std.testing.expectEqual(0x3.ffd4486dbdde99c4bf021e6118b6p-4, acospi(@as(f128, 0xb.50b04f0a7917332097372387fp-4)));
}
